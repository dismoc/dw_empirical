label = 'main_reg',
headers = c('Pooled', 'Large Banks','Small Banks'),
fitstat = ~ n +  r2+ ivf + wh,
group = list('Controls:'=c('Offices','Ratio','Impact',
'lsa','rsa','dsa','Equity Cap Ratio','Log Assets','Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')),
tex = F)
ta7[[1]] <- update(ta2[[2]], .~. - pppsores | . |  i(LF_pre,pppsores) ~  i(LF_pre,asinh(c_instr)))
ta7[[2]] <- update(ta7[[1]], subset = sf3$bigsmall == 1 )
ta7[[3]] <- update(ta7[[1]], subset = sf3$bigsmall == 0)
ta7[[4]] <- update(ta[[2]],.~. - pppsores |.|  i(LF_pre,pppsores) ~  i(LF_pre,asinh(c_instr)), data=sft)
ta7[[5]] <- update(ta7[[4]], subset = sft$bigsmall == 1)
ta7[[6]] <- update(ta7[[4]], subset = sft$bigsmall == 0)
etable(ta7, dict = dict1,
title = 'OLS Estimation of Log DW Borrowing',
label = 'main_reg',
headers = c('Pooled', 'Large Banks','Small Banks'),
fitstat = ~ n +  r2+ ivf + wh,
group = list('Controls:'=c('Offices','Ratio','Impact',
'lsa','rsa','dsa','Equity Cap Ratio','Log Assets','Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')),
tex = F)
ta6 <- list()
ta6[[1]] <- update(ta2[[2]], .~. - pppsores + l(pppsores) | . |pppsores ~ asinh(c_instrl))
ta6[[2]] <- update(ta6[[1]], .~. |.| . ~.  , subset = sf3$bigsmall == 1, panel.id =c('RSSD','Date'))
ta6[[3]] <- update(ta6[[1]], .~. |.| . ~ ., subset = sf3$bigsmall == 0, panel.id =c('RSSD','Date'))
ta6[[5]] <- update(ta[[2]], .~. - pppsores + l(pppsores)| . |  pppsores ~ asinh(c_instrl), data=sft )
ta6[[6]] <- update(ta6[[5]], .~. |.| . ~. , subset = sft$bigsmall == 1, panel.id =c('RSSD','Date'))
ta6[[7]] <- update(ta6[[5]], .~. |.| . ~ ., subset = sft$bigsmall == 0, panel.id =c('RSSD','Date'))
etable(ta6, dict = dict1, stage=2,
title = 'OLS Estimation of Log DW Borrowing',
label = 'main_reg',
headers = c('Pooled', 'Large Banks','Small Banks'),
fitstat = ~ n + ivf + wh + sargan,
group = list('LS2020 Controls:'=c('Offices','Ratio','Impact',
'lsa','rsa','dsa','Equity Cap Ratio','Log Assets','Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')),
tex = F)
etable(ta6)
ta7 <- list()
ta7[[1]] <- update(ta2[[2]], .~. - pppsores | . |  i(LF_pre,pppsores) ~  i(LF_pre,asinh(c_instrl)))
ta7[[2]] <- update(ta7[[1]], subset = sf3$bigsmall == 1 )
ta7[[3]] <- update(ta7[[1]], subset = sf3$bigsmall == 0)
ta7[[4]] <- update(ta[[2]],.~. - pppsores |.|  i(LF_pre,pppsores) ~  i(LF_pre,asinh(c_instrl)), data=sft)
ta7[[5]] <- update(ta7[[4]], subset = sft$bigsmall == 1)
ta7[[6]] <- update(ta7[[4]], subset = sft$bigsmall == 0)
etable(ta7, dict = dict1,
title = 'OLS Estimation of Log DW Borrowing',
label = 'main_reg',
headers = c('Pooled', 'Large Banks','Small Banks'),
fitstat = ~ n,
group = list('Controls:'=c('Offices','Ratio','Impact',
'lsa','rsa','dsa','Equity Cap Ratio','Log Assets','Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')),
tex = F)
etable(ta7, dict = dict1,
title = 'OLS Estimation of Log DW Borrowing',
label = 'main_reg',
headers = c('Pooled', 'Large Banks','Small Banks'),
fitstat = ~ n,
group = list('Controls:'=c('Offices','Ratio','Impact',
'lsa','rsa','dsa','Equity Cap Ratio','Log Assets','Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')),
tex = T)
ta8 <- list()
ta8[[1]] <- update(ta2[[2]], .~. - pppsores + i(week,pppsores))
ta8[[2]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[3]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 0, panel.id =c('RSSD','Date'))
ta8[[5]] <- update(ta[[2]], .~. - pppsores + i(week,pppsores), data = sft)
ta8[[6]] <- update(ta8[[5]], .~., subset = sft$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[7]] <- update(ta8[[5]], .~. , subset = sft$bigsmall == 0, panel.id =c('RSSD','Date'))
etable(ta8, dict = dict1, stage=2,
title = 'OLS Estimation of Log DW Borrowing',
label = 'main_reg',
headers = c('Pooled', 'Large Banks','Small Banks'),
fitstat = ~ n + ivf + wh + sargan,
group = list('LS2020 Controls:'=c('Offices','Ratio','Impact',
'lsa','rsa','dsa','Equity Cap Ratio','Log Assets','Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')),
tex = F)
ta8[[1]] <- update(ta2[[2]], .~i(week,pppsores) + . - pppsores)
ta8[[2]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[3]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 0, panel.id =c('RSSD','Date'))
etable(ta8, dict = dict1, stage=2,
title = 'OLS Estimation of Log DW Borrowing',
label = 'main_reg',
headers = c('Pooled', 'Large Banks','Small Banks'),
fitstat = ~ n + ivf + wh + sargan,
group = list('LS2020 Controls:'=c('Offices','Ratio','Impact',
'lsa','rsa','dsa','Equity Cap Ratio','Log Assets','Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')),
tex = F)
ta8[[5]] <- update(ta[[2]], .~. i(week,pppsores) + . - pppsores, data = sft)
ta8[[6]] <- update(ta8[[5]], .~., subset = sft$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[7]] <- update(ta8[[5]], .~. , subset = sft$bigsmall == 0, panel.id =c('RSSD','Date'))
etable(ta8, dict = dict1, stage=2,
title = 'OLS Estimation of Log DW Borrowing',
label = 'main_reg',
headers = c('Pooled', 'Large Banks','Small Banks'),
fitstat = ~ n + ivf + wh + sargan,
group = list('LS2020 Controls:'=c('Offices','Ratio','Impact',
'lsa','rsa','dsa','Equity Cap Ratio','Log Assets','Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')),
tex = F)
ta8[[1]]$coefficients[1:8]
data.table(Weeks = 1:8, prob_pooled = ta8[[1]]$coefficients[1:8], prob_large = ta8[[2]]$coefficients[1:8], prob_small = ta8[[3]]$coefficients[1:8],
quant_pooled = ta8[[4]]$coefficients[1:8], quant_large = ta8[[5]]$coefficients[1:8], quant_small = ta8[[6]]$coefficients[1:8])
ta8[[1]]$se
ta8[[1]]$se[1:8]
data.table(Weeks = 1:8, prob_pooled = ta8[[1]]$coefficients[1:8], prob_large = ta8[[2]]$coefficients[1:8], prob_small = ta8[[3]]$coefficients[1:8],
quant_pooled = ta8[[4]]$coefficients[1:8], quant_large = ta8[[5]]$coefficients[1:8], quant_small = ta8[[6]]$coefficients[1:8],
pp_se = ta8[[1]]$se[1:8], pl_se = ta8[[2]]$se[1:8], ps_se = ta8[[3]]$se[1:8],
qp_se = ta8[[4]]$se[1:8], ql_se = ta8[[5]]$se[1:8], qs_se = ta8[[6]]$se[1:8])
plot1 <- data.table(Weeks = 1:8, prob_pooled = ta8[[1]]$coefficients[1:8], prob_large = ta8[[2]]$coefficients[1:8], prob_small = ta8[[3]]$coefficients[1:8],
quant_pooled = ta8[[4]]$coefficients[1:8], quant_large = ta8[[5]]$coefficients[1:8], quant_small = ta8[[6]]$coefficients[1:8],
pp_se = ta8[[1]]$se[1:8], pl_se = ta8[[2]]$se[1:8], ps_se = ta8[[3]]$se[1:8],
qp_se = ta8[[4]]$se[1:8], ql_se = ta8[[5]]$se[1:8], qs_se = ta8[[6]]$se[1:8])
plot1
ta8[[1]]$se
ta8[[1]]
0.011201/0.0028341463
ta8[[1]] <- update(ta2[[2]], .~i(week,pppsores) + . - pppsores, cluster='RSSD')
ta8[[1]]
ta8[[1]]$se
ta8[[2]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[3]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 0, panel.id =c('RSSD','Date'))
ta8[[5]] <- update(ta[[2]], .~. i(week,pppsores) + . - pppsores, data = sft, cluster='RSSD')
ta8[[6]] <- update(ta8[[5]], .~., subset = sft$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[7]] <- update(ta8[[5]], .~. , subset = sft$bigsmall == 0, panel.id =c('RSSD','Date'))
plot1 <- data.table(Weeks = 1:8, prob_pooled = ta8[[1]]$coefficients[1:8], prob_large = ta8[[2]]$coefficients[1:8], prob_small = ta8[[3]]$coefficients[1:8],
quant_pooled = ta8[[4]]$coefficients[1:8], quant_large = ta8[[5]]$coefficients[1:8], quant_small = ta8[[6]]$coefficients[1:8],
pp_se = ta8[[1]]$se[1:8], pl_se = ta8[[2]]$se[1:8], ps_se = ta8[[3]]$se[1:8],
qp_se = ta8[[4]]$se[1:8], ql_se = ta8[[5]]$se[1:8], qs_se = ta8[[6]]$se[1:8])
plot1
0.02636646/0.01120104
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = prob_pooled, ymin=prob_pooled-1.96*pp_se, ymax=prob_pooled+1.96*pp_se), width=.1) + geom_point(aes(y=prob_pooled))
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = prob_pooled, ymin=prob_pooled-1.64*pp_se, ymax=prob_pooled+1.64*pp_se), width=.1) + geom_point(aes(y=prob_pooled))
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = prob_pooled, ymin=prob_pooled-1.64*pp_se, ymax=prob_pooled+1.64*pp_se, color='red'), width=.1) + geom_point(aes(y=prob_pooled, color='red')) +
# Cross Sectional Data Creation - Aggregating all daily info during COVID to a cross section ----
sf4 <- aggregate(cbind(PPP, PPPLF, DW, eci, covexpo, dwbin_notest, PPPLF_ind, ppp_ind, n) ~ RSSD, sf3, sum)
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = prob_pooled, ymin=prob_pooled-1.64*pp_se, ymax=prob_pooled+1.64*pp_se, color='red'), width=.1) + geom_point(aes(y=prob_pooled, color='red'))
data.table(Weeks = 1:8, prob_pooled = ta8[[1]]$coefficients[1:8], prob_large = ta8[[2]]$coefficients[1:8], prob_small = ta8[[3]]$coefficients[1:8],
quant_pooled = ta8[[4]]$coefficients[1:8], quant_large = ta8[[5]]$coefficients[1:8], quant_small = ta8[[6]]$coefficients[1:8],
pp_se = ta8[[1]]$se[1:8], pl_se = ta8[[2]]$se[1:8], ps_se = ta8[[3]]$se[1:8],
qp_se = ta8[[4]]$se[1:8], ql_se = ta8[[5]]$se[1:8], qs_se = ta8[[6]]$se[1:8])
ta8[[4]]$coefficients[1:8]
ta8 <- list()
ta8[[1]] <- update(ta2[[2]], .~i(week,pppsores) + . - pppsores, cluster='RSSD')
ta8[[2]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[3]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 0, panel.id =c('RSSD','Date'))
ta8[[4]] <- update(ta[[2]], .~. i(week,pppsores) + . - pppsores, data = sft, cluster='RSSD')
ta8[[5]] <- update(ta8[[5]], .~., subset = sft$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[6]] <- update(ta8[[5]], .~. , subset = sft$bigsmall == 0, panel.id =c('RSSD','Date'))
plot1 <- data.table(Weeks = 1:8, prob_pooled = ta8[[1]]$coefficients[1:8], prob_large = ta8[[2]]$coefficients[1:8], prob_small = ta8[[3]]$coefficients[1:8],
quant_pooled = ta8[[4]]$coefficients[1:8], quant_large = ta8[[5]]$coefficients[1:8], quant_small = ta8[[6]]$coefficients[1:8],
pp_se = ta8[[1]]$se[1:8], pl_se = ta8[[2]]$se[1:8], ps_se = ta8[[3]]$se[1:8],
qp_se = ta8[[4]]$se[1:8], ql_se = ta8[[5]]$se[1:8], qs_se = ta8[[6]]$se[1:8])
ta8[[4]] <- update(ta[[2]], .~. i(week,pppsores) + . - pppsores, data = sft, cluster='RSSD')
ta8[[5]] <- update(ta8[[4]], .~., subset = sft$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[6]] <- update(ta8[[4]], .~. , subset = sft$bigsmall == 0, panel.id =c('RSSD','Date'))
plot1 <- data.table(Weeks = 1:8, prob_pooled = ta8[[1]]$coefficients[1:8], prob_large = ta8[[2]]$coefficients[1:8], prob_small = ta8[[3]]$coefficients[1:8],
quant_pooled = ta8[[4]]$coefficients[1:8], quant_large = ta8[[5]]$coefficients[1:8], quant_small = ta8[[6]]$coefficients[1:8],
pp_se = ta8[[1]]$se[1:8], pl_se = ta8[[2]]$se[1:8], ps_se = ta8[[3]]$se[1:8],
qp_se = ta8[[4]]$se[1:8], ql_se = ta8[[5]]$se[1:8], qs_se = ta8[[6]]$se[1:8])
ta8
ta8[[4]] <- update(ta[[2]], .~. i(week,pppsores) + . - pppsores, data = sft, cluster='RSSD')
ta8[[4]] <- update(ta[[2]], .~ i(week,pppsores) + . - pppsores, data = sft, cluster='RSSD')
ta8[[5]] <- update(ta8[[4]], .~., subset = sft$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[6]] <- update(ta8[[4]], .~. , subset = sft$bigsmall == 0, panel.id =c('RSSD','Date'))
plot1 <- data.table(Weeks = 1:8, prob_pooled = ta8[[1]]$coefficients[1:8], prob_large = ta8[[2]]$coefficients[1:8], prob_small = ta8[[3]]$coefficients[1:8],
quant_pooled = ta8[[4]]$coefficients[1:8], quant_large = ta8[[5]]$coefficients[1:8], quant_small = ta8[[6]]$coefficients[1:8],
pp_se = ta8[[1]]$se[1:8], pl_se = ta8[[2]]$se[1:8], ps_se = ta8[[3]]$se[1:8],
qp_se = ta8[[4]]$se[1:8], ql_se = ta8[[5]]$se[1:8], qs_se = ta8[[6]]$se[1:8])
plot1
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = prob_pooled, ymin=prob_pooled-1.64*pp_se, ymax=prob_pooled+1.64*pp_se, color='red'), width=.1) + geom_point(aes(y=prob_pooled, color='red')) +
geom_errorbar(aes(y = quant_pooled, ymin=quant_pooled-1.64*qp_se, ymax=quant_pooled+1.64*qp_se, color='blue'), width=.1) + geom_point(aes(y=quant_pooled, color='blue'))
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = prob_pooled, ymin=prob_pooled-1.64*pp_se, ymax=prob_pooled+1.64*pp_se, color='red'), width=.1) + geom_point(aes(y=prob_pooled, color='red')) +
geom_errorbar(aes(y = prob_large, ymin=prob_large-1.64*pl_se, ymax=prob_large+1.64*pl_se, color='blue'), position = position_nudge(x=.2), width=.1) +
geom_point(aes(y=prob_large, color='blue'), position = position_nudge(x=.2))
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = prob_pooled, ymin=prob_pooled-1.64*pp_se, ymax=prob_pooled+1.64*pp_se, color='red'), width=.1) + geom_point(aes(y=prob_pooled, color='red')) +
geom_errorbar(aes(y = prob_large, ymin=prob_large-1.64*pl_se, ymax=prob_large+1.64*pl_se, color='blue'), position = position_nudge(x=.2), width=.1) +
geom_point(aes(y=prob_large, color='blue'), position = position_nudge(x=.2)) +
geom_errorbar(aes(y = prob_small, ymin=prob_small-1.64*ps_se, ymax=prob_small+1.64*ps_se, color='blue'), position = position_nudge(x=-.2), width=.1) +
geom_point(aes(y=prob_small, color='blue'), position = position_nudge(x=-.2))
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = prob_pooled, ymin=prob_pooled-1.64*pp_se, ymax=prob_pooled+1.64*pp_se, color='red'), width=.1) + geom_point(aes(y=prob_pooled, color='red')) +
geom_errorbar(aes(y = prob_large, ymin=prob_large-1.64*pl_se, ymax=prob_large+1.64*pl_se, color='blue'), position = position_nudge(x=.2), width=.1) +
geom_point(aes(y=prob_large, color='blue'), position = position_nudge(x=.2)) +
geom_errorbar(aes(y = prob_small, ymin=prob_small-1.64*ps_se, ymax=prob_small+1.64*ps_se, color='green'), position = position_nudge(x=-.2), width=.1) +
geom_point(aes(y=prob_small, color='green'), position = position_nudge(x=-.2))
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = prob_pooled, ymin=prob_pooled-1.64*pp_se, ymax=prob_pooled+1.64*pp_se, color='Pooled Banks'), width=.1) + geom_point(aes(y=prob_pooled, color='Pooled Banks')) +
geom_errorbar(aes(y = prob_large, ymin=prob_large-1.64*pl_se, ymax=prob_large+1.64*pl_se, color='Large Banks'), position = position_nudge(x=.2), width=.1) +
geom_point(aes(y=prob_large, color='Large Banks'), position = position_nudge(x=.2)) +
geom_errorbar(aes(y = prob_small, ymin=prob_small-1.64*ps_se, ymax=prob_small+1.64*ps_se, color='Small Banks'), position = position_nudge(x=-.2), width=.1) +
geom_point(aes(y=prob_small, color='Small Banks'), position = position_nudge(x=-.2))
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = quant_pooled, ymin=quant_pooled-1.64*qp_se, ymax=quant_pooled+1.64*qp_se, color='Pooled Banks'), width=.1) + geom_point(aes(y=quant_pooled, color='Pooled Banks')) +
geom_errorbar(aes(y = quant_large, ymin=quant_large-1.64*ql_se, ymax=quant_large+1.64*ql_se, color='Large Banks'), position = position_nudge(x=.2), width=.1) +
geom_point(aes(y=quant_large, color='Large Banks'), position = position_nudge(x=.2)) +
geom_errorbar(aes(y = quant_small, ymin=quant_small-1.64*qs_se, ymax=quant_small+1.64*qs_se, color='Small Banks'), position = position_nudge(x=-.2), width=.1) +
geom_point(aes(y=quant_small, color='Small Banks'), position = position_nudge(x=-.2))
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = prob_pooled, ymin=prob_pooled-1.64*pp_se, ymax=prob_pooled+1.64*pp_se, color='Pooled Banks'), width=.1) + geom_point(aes(y=prob_pooled, color='Pooled Banks')) +
geom_errorbar(aes(y = prob_large, ymin=prob_large-1.64*pl_se, ymax=prob_large+1.64*pl_se, color='Large Banks'), position = position_nudge(x=.2), width=.1) +
geom_point(aes(y=prob_large, color='Large Banks'), position = position_nudge(x=.2)) +
geom_errorbar(aes(y = prob_small, ymin=prob_small-1.64*ps_se, ymax=prob_small+1.64*ps_se, color='Small Banks'), position = position_nudge(x=-.2), width=.1) +
geom_point(aes(y=prob_small, color='Small Banks'), position = position_nudge(x=-.2))
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = quant_pooled, ymin=quant_pooled-1.64*qp_se, ymax=quant_pooled+1.64*qp_se, color='Pooled Banks'), width=.1) + geom_point(aes(y=quant_pooled, color='Pooled Banks')) +
geom_errorbar(aes(y = quant_large, ymin=quant_large-1.64*ql_se, ymax=quant_large+1.64*ql_se, color='Large Banks'), position = position_nudge(x=.2), width=.1) +
geom_point(aes(y=quant_large, color='Large Banks'), position = position_nudge(x=.2)) +
geom_errorbar(aes(y = quant_small, ymin=quant_small-1.64*qs_se, ymax=quant_small+1.64*qs_se, color='Small Banks'), position = position_nudge(x=-.2), width=.1) +
geom_point(aes(y=quant_small, color='Small Banks'), position = position_nudge(x=-.2))
ta8
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = prob_pooled, ymin=prob_pooled-1.64*pp_se, ymax=prob_pooled+1.64*pp_se, color='Pooled Banks'), width=.1) + geom_point(aes(y=prob_pooled, color='Pooled Banks')) +
geom_errorbar(aes(y = prob_large, ymin=prob_large-1.64*pl_se, ymax=prob_large+1.64*pl_se, color='Large Banks'), position = position_nudge(x=.2), width=.1) +
geom_point(aes(y=prob_large, color='Large Banks'), position = position_nudge(x=.2)) +
geom_errorbar(aes(y = prob_small, ymin=prob_small-1.64*ps_se, ymax=prob_small+1.64*ps_se, color='Small Banks'), position = position_nudge(x=-.2), width=.1) +
geom_point(aes(y=prob_small, color='Small Banks'), position = position_nudge(x=-.2)) +
ylab('Betas Of Probability')
plot1 <- data.table(Weeks = 1:6, prob_pooled = ta8[[1]]$coefficients[1:6], prob_large = ta8[[2]]$coefficients[1:6], prob_small = ta8[[3]]$coefficients[1:6],
quant_pooled = ta8[[4]]$coefficients[1:6], quant_large = ta8[[5]]$coefficients[1:6], quant_small = ta8[[6]]$coefficients[1:6],
pp_se = ta8[[1]]$se[1:6], pl_se = ta8[[2]]$se[1:6], ps_se = ta8[[3]]$se[1:6],
qp_se = ta8[[4]]$se[1:6], ql_se = ta8[[5]]$se[1:6], qs_se = ta8[[6]]$se[1:6])
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = prob_pooled, ymin=prob_pooled-1.64*pp_se, ymax=prob_pooled+1.64*pp_se, color='Pooled Banks'), width=.1) + geom_point(aes(y=prob_pooled, color='Pooled Banks')) +
geom_errorbar(aes(y = prob_large, ymin=prob_large-1.64*pl_se, ymax=prob_large+1.64*pl_se, color='Large Banks'), position = position_nudge(x=.2), width=.1) +
geom_point(aes(y=prob_large, color='Large Banks'), position = position_nudge(x=.2)) +
geom_errorbar(aes(y = prob_small, ymin=prob_small-1.64*ps_se, ymax=prob_small+1.64*ps_se, color='Small Banks'), position = position_nudge(x=-.2), width=.1) +
geom_point(aes(y=prob_small, color='Small Banks'), position = position_nudge(x=-.2)) +
ylab('Betas Of Probability')
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = quant_pooled, ymin=quant_pooled-1.64*qp_se, ymax=quant_pooled+1.64*qp_se, color='Pooled Banks'), width=.1) + geom_point(aes(y=quant_pooled, color='Pooled Banks')) +
geom_errorbar(aes(y = quant_large, ymin=quant_large-1.64*ql_se, ymax=quant_large+1.64*ql_se, color='Large Banks'), position = position_nudge(x=.2), width=.1) +
geom_point(aes(y=quant_large, color='Large Banks'), position = position_nudge(x=.2)) +
geom_errorbar(aes(y = quant_small, ymin=quant_small-1.64*qs_se, ymax=quant_small+1.64*qs_se, color='Small Banks'), position = position_nudge(x=-.2), width=.1) +
geom_point(aes(y=quant_small, color='Small Banks'), position = position_nudge(x=-.2)) +
ylab('Betas Of Quantity')
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = quant_pooled, ymin=quant_pooled-1.64*qp_se, ymax=quant_pooled+1.64*qp_se, color='Pooled Banks'), width=.1) + geom_point(aes(y=quant_pooled, color='Pooled Banks')) +
geom_errorbar(aes(y = quant_large, ymin=quant_large-1.64*ql_se, ymax=quant_large+1.64*ql_se, color='Large Banks'), position = position_nudge(x=.2), width=.1) +
geom_point(aes(y=quant_large, color='Large Banks'), position = position_nudge(x=.2)) +
geom_errorbar(aes(y = quant_small, ymin=quant_small-1.64*qs_se, ymax=quant_small+1.64*qs_se, color='Small Banks'), position = position_nudge(x=-.2), width=.1) +
geom_point(aes(y=quant_small, color='Small Banks'), position = position_nudge(x=-.2)) +
ylab('Betas Of Quantity')
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = prob_pooled, ymin=prob_pooled-1.64*pp_se, ymax=prob_pooled+1.64*pp_se, color='Pooled Banks'), width=.1) + geom_point(aes(y=prob_pooled, color='Pooled Banks')) +
geom_errorbar(aes(y = prob_large, ymin=prob_large-1.64*pl_se, ymax=prob_large+1.64*pl_se, color='Large Banks'), position = position_nudge(x=.2), width=.1) +
geom_point(aes(y=prob_large, color='Large Banks'), position = position_nudge(x=.2)) +
geom_errorbar(aes(y = prob_small, ymin=prob_small-1.64*ps_se, ymax=prob_small+1.64*ps_se, color='Small Banks'), position = position_nudge(x=-.2), width=.1) +
geom_point(aes(y=prob_small, color='Small Banks'), position = position_nudge(x=-.2)) +
ylab('Betas Of Probability')
# PPP, DW, PPPLF, from 04-06
ggplot(sfc) +
geom_line(aes(x = Date, y = PPP/8, colour ='PPP Lending'), size=1.5) +
#geom_line(aes(x = Date, y = LF_request , colour ='LF Requested'), size=1.5) +
#geom_line(aes(x = Date, y = LF_received , colour ='LF Received'), size=1.5) +
geom_line(aes(x = Date, y = DW, colour ='DW Borrowing'), size=1.5) +
scale_y_continuous(name = "Daily DW Quantity",
sec.axis = sec_axis(~.*8, name="Daily PPP Loans", labels = label_number(suffix = "B", scale = 1e-9)),
labels = label_number(suffix = "B", scale = 1e-9)) +
labs(x="Date") + scale_x_date(date_breaks = '2 weeks') +
theme(legend.position = c(.85, .85), legend.title=element_blank(), text = element_text(24)) +
geom_vline(xintercept = as.Date('2020-04-03'), linetype='dashed', size = 1.5)+
geom_vline(xintercept = as.Date('2020-04-27'), linetype='dashed', size = 1.5)+
geom_vline(xintercept = as.Date('2020-04-16'), linetype='dashed', size = 1, color ='red')+
annotate('rect',fill='gray',xmin=as.Date('2020-04-03'),xmax = as.Date('2020-04-16'),ymin = -Inf, ymax = Inf, alpha = .5) +
annotate('rect',fill='gray',xmin=as.Date('2020-04-27'),xmax = as.Date('2020-06-01'),ymin = -Inf, ymax = Inf, alpha = .4) +
annotate("text", x=as.Date('2020-04-02'), y=1e9, label="PPP Phase 1", angle=90) +
annotate("text", x=as.Date('2020-04-26'), y=1e9, label="PPP Phase 2", angle=90) +
annotate("text", x=as.Date('2020-04-17'), y=6e9, label="First PPPLF Disbursed", angle=270)
# Time series figure about the PPP shock and the DW borrowing sizes ----
sfc <- subset(sf, Date >= '2020-04-03' & Date <= '2020-06-01')
# Plotting the number of DW loans agains the PPP lending
plot1 <- aggregate(cbind(dwbin_notest, dw_bin, PPP) ~ Date, sf3, sum)
plot1 <- subset(plot1, Date <= as.Date('2020-08-07'))
plot1$dw_bin <- ifelse(plot1$dw_bin == 0, NA, plot1$dw_bin)
plot1$dwbin_notest <- ifelse(plot1$dwbin_notest == 0, NA, plot1$dwbin_notest)
plot1 <- plot1 %>% mutate(dw_bin = na.approx(dw_bin), dwbin_notest = na.approx(dwbin_notest))
plot1$PPP <- plot1$PPP/1000000000
ggplot(plot1) +
geom_line(aes(x=Date, y= dw_bin, colour = 'DW Borrowing Count')) +
geom_line(aes(x=Date, y= PPP, colour = 'PPP Borrowing'))
# PPP, DW, PPPLF, from 04-06
ggplot(sfc) +
geom_line(aes(x = Date, y = PPP/8, colour ='PPP Lending'), size=1.5) +
#geom_line(aes(x = Date, y = LF_request , colour ='LF Requested'), size=1.5) +
#geom_line(aes(x = Date, y = LF_received , colour ='LF Received'), size=1.5) +
geom_line(aes(x = Date, y = DW, colour ='DW Borrowing'), size=1.5) +
scale_y_continuous(name = "Daily DW Quantity",
sec.axis = sec_axis(~.*8, name="Daily PPP Loans", labels = label_number(suffix = "B", scale = 1e-9)),
labels = label_number(suffix = "B", scale = 1e-9)) +
labs(x="Date") + scale_x_date(date_breaks = '2 weeks') +
theme(legend.position = c(.85, .85), legend.title=element_blank(), text = element_text(24)) +
geom_vline(xintercept = as.Date('2020-04-03'), linetype='dashed', size = 1.5)+
geom_vline(xintercept = as.Date('2020-04-27'), linetype='dashed', size = 1.5)+
geom_vline(xintercept = as.Date('2020-04-16'), linetype='dashed', size = 1, color ='red')+
annotate('rect',fill='gray',xmin=as.Date('2020-04-03'),xmax = as.Date('2020-04-16'),ymin = -Inf, ymax = Inf, alpha = .5) +
annotate('rect',fill='gray',xmin=as.Date('2020-04-27'),xmax = as.Date('2020-06-01'),ymin = -Inf, ymax = Inf, alpha = .4) +
annotate("text", x=as.Date('2020-04-02'), y=1e9, label="PPP Phase 1", angle=90) +
annotate("text", x=as.Date('2020-04-26'), y=1e9, label="PPP Phase 2", angle=90) +
annotate("text", x=as.Date('2020-04-17'), y=6e9, label="First PPPLF Disbursed", angle=270)
sfc
feols(pppe ~ lab_share, sf4)
feols(pppe ~ lab_share + scisoa, sf4)
ta8[[1]] <- update(ta2[[2]], .~i(week,pppsores)*LF_pre + . - pppsores, cluster='RSSD')
ta8[[2]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[3]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 0, panel.id =c('RSSD','Date'))
ta8[[4]] <- update(ta[[2]], .~ i(week,pppsores)*LF_pre + . - pppsores, data = sft, cluster='RSSD')
ta8[[5]] <- update(ta8[[4]], .~., subset = sft$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[6]] <- update(ta8[[4]], .~. , subset = sft$bigsmall == 0, panel.id =c('RSSD','Date'))
etable(ta8)
ta8[[4]] <- update(ta[[2]], .~ i(week,pppsores):LF_pre + . - pppsores, data = sft, cluster='RSSD')
ta8[[5]] <- update(ta8[[4]], .~., subset = sft$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[6]] <- update(ta8[[4]], .~. , subset = sft$bigsmall == 0, panel.id =c('RSSD','Date'))
etable(ta8)
ta8[[1]] <- update(ta2[[2]], .~i(week,pppsores):LF_pre + . - pppsores, cluster='RSSD')
ta8[[2]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[3]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 0, panel.id =c('RSSD','Date'))
etable(ta8)
etable(ta8,
group = list('LS2020 Controls:'=c('Offices','Ratio','Impact',
'lsa','rsa','dsa','Equity Cap Ratio','Log Assets','Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')),
)
etable(ta8,
group = list('LS2020 Controls:'=c('Offices','Ratio','Impact',
'lsa','rsa','dsa','Equity Cap Ratio','Log Assets','Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')))
etable(ta8,
group = list('LS2020 Controls:'=c('Offices','Ratio','Impact','lsa','rsa','dsa','Equity Cap Ratio','Log Assets',
'Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')))
etable(ta8, dict=dict1,
group = list('LS2020 Controls:'=c('Offices','Ratio','Impact','lsa','rsa','dsa','Equity Cap Ratio','Log Assets',
'Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')))
ta8[[1]] <- update(ta2[[2]], .~i(LF_pre,i(week,pppsores)) + . - pppsores, cluster='RSSD')
ta8[[2]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[3]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 0, panel.id =c('RSSD','Date'))
etable(ta8, dict=dict1,
group = list('LS2020 Controls:'=c('Offices','Ratio','Impact','lsa','rsa','dsa','Equity Cap Ratio','Log Assets',
'Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')))
i()
ta8[[1]] <- update(ta2[[2]], .~i(week,pppsores) + . - pppsores, cluster='RSSD', subset= sf3$LF_pre==1)
ta8[[2]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[3]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 0, panel.id =c('RSSD','Date'))
etable(ta8, dict=dict1,
group = list('LS2020 Controls:'=c('Offices','Ratio','Impact','lsa','rsa','dsa','Equity Cap Ratio','Log Assets',
'Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')))
ta8[[4]] <- update(ta[[2]], .~ i(week,pppsores) + . - pppsores, data = sft, cluster='RSSD')
ta8[[5]] <- update(ta8[[4]], .~., subset = sft$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[6]] <- update(ta8[[4]], .~. , subset = sft$bigsmall == 0, panel.id =c('RSSD','Date'))
etable(ta8, dict=dict1,
group = list('LS2020 Controls:'=c('Offices','Ratio','Impact','lsa','rsa','dsa','Equity Cap Ratio','Log Assets',
'Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')))
plot1 <- data.table(Weeks = 1:6, prob_pooled = ta8[[1]]$coefficients[1:6], prob_large = ta8[[2]]$coefficients[1:6], prob_small = ta8[[3]]$coefficients[1:6],
quant_pooled = ta8[[4]]$coefficients[1:6], quant_large = ta8[[5]]$coefficients[1:6], quant_small = ta8[[6]]$coefficients[1:6],
pp_se = ta8[[1]]$se[1:6], pl_se = ta8[[2]]$se[1:6], ps_se = ta8[[3]]$se[1:6],
qp_se = ta8[[4]]$se[1:6], ql_se = ta8[[5]]$se[1:6], qs_se = ta8[[6]]$se[1:6])
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = prob_pooled, ymin=prob_pooled-1.64*pp_se, ymax=prob_pooled+1.64*pp_se, color='Pooled Banks'), width=.1) + geom_point(aes(y=prob_pooled, color='Pooled Banks')) +
geom_errorbar(aes(y = prob_large, ymin=prob_large-1.64*pl_se, ymax=prob_large+1.64*pl_se, color='Large Banks'), position = position_nudge(x=.2), width=.1) +
geom_point(aes(y=prob_large, color='Large Banks'), position = position_nudge(x=.2)) +
geom_errorbar(aes(y = prob_small, ymin=prob_small-1.64*ps_se, ymax=prob_small+1.64*ps_se, color='Small Banks'), position = position_nudge(x=-.2), width=.1) +
geom_point(aes(y=prob_small, color='Small Banks'), position = position_nudge(x=-.2)) +
ylab('Betas Of Probability')
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = quant_pooled, ymin=quant_pooled-1.64*qp_se, ymax=quant_pooled+1.64*qp_se, color='Pooled Banks'), width=.1) + geom_point(aes(y=quant_pooled, color='Pooled Banks')) +
geom_errorbar(aes(y = quant_large, ymin=quant_large-1.64*ql_se, ymax=quant_large+1.64*ql_se, color='Large Banks'), position = position_nudge(x=.2), width=.1) +
geom_point(aes(y=quant_large, color='Large Banks'), position = position_nudge(x=.2)) +
geom_errorbar(aes(y = quant_small, ymin=quant_small-1.64*qs_se, ymax=quant_small+1.64*qs_se, color='Small Banks'), position = position_nudge(x=-.2), width=.1) +
geom_point(aes(y=quant_small, color='Small Banks'), position = position_nudge(x=-.2)) +
ylab('Betas Of Quantity')
ta8[[4]] <- update(ta[[2]], .~ i(week,pppsores) + . - pppsores, data = sft, cluster='RSSD',subset= sf3$LF_pre==1)
ta8[[5]] <- update(ta8[[4]], .~., subset = sft$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[6]] <- update(ta8[[4]], .~. , subset = sft$bigsmall == 0, panel.id =c('RSSD','Date'))
etable(ta8, dict=dict1,
group = list('LS2020 Controls:'=c('Offices','Ratio','Impact','lsa','rsa','dsa','Equity Cap Ratio','Log Assets',
'Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')))
# Table 3 - IV Results (Pooled, Large, small) with controls using the daily data ----
ta8 <- list()
ta8[[1]] <- update(ta2[[2]], .~i(week,pppsores) + . - pppsores, cluster='RSSD', subset= sf3$LF_pre==1)
ta8[[2]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[3]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 0, panel.id =c('RSSD','Date'))
ta8[[4]] <- update(ta[[2]], .~ i(week,pppsores) + . - pppsores, data = sft, cluster='RSSD',subset= sf3$LF_pre==1)
ta8[[5]] <- update(ta8[[4]], .~., subset = sft$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[6]] <- update(ta8[[4]], .~. , subset = sft$bigsmall == 0, panel.id =c('RSSD','Date'))
etable(ta8, dict=dict1,
group = list('LS2020 Controls:'=c('Offices','Ratio','Impact','lsa','rsa','dsa','Equity Cap Ratio','Log Assets',
'Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')))
plot1 <- data.table(Weeks = 1:6, prob_pooled = ta8[[1]]$coefficients[1:6], prob_large = ta8[[2]]$coefficients[1:6], prob_small = ta8[[3]]$coefficients[1:6],
quant_pooled = ta8[[4]]$coefficients[1:6], quant_large = ta8[[5]]$coefficients[1:6], quant_small = ta8[[6]]$coefficients[1:6],
pp_se = ta8[[1]]$se[1:6], pl_se = ta8[[2]]$se[1:6], ps_se = ta8[[3]]$se[1:6],
qp_se = ta8[[4]]$se[1:6], ql_se = ta8[[5]]$se[1:6], qs_se = ta8[[6]]$se[1:6])
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = prob_pooled, ymin=prob_pooled-1.64*pp_se, ymax=prob_pooled+1.64*pp_se, color='Pooled Banks'), width=.1) + geom_point(aes(y=prob_pooled, color='Pooled Banks')) +
geom_errorbar(aes(y = prob_large, ymin=prob_large-1.64*pl_se, ymax=prob_large+1.64*pl_se, color='Large Banks'), position = position_nudge(x=.2), width=.1) +
geom_point(aes(y=prob_large, color='Large Banks'), position = position_nudge(x=.2)) +
geom_errorbar(aes(y = prob_small, ymin=prob_small-1.64*ps_se, ymax=prob_small+1.64*ps_se, color='Small Banks'), position = position_nudge(x=-.2), width=.1) +
geom_point(aes(y=prob_small, color='Small Banks'), position = position_nudge(x=-.2)) +
ylab('Betas Of Probability')
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = quant_pooled, ymin=quant_pooled-1.64*qp_se, ymax=quant_pooled+1.64*qp_se, color='Pooled Banks'), width=.1) + geom_point(aes(y=quant_pooled, color='Pooled Banks')) +
geom_errorbar(aes(y = quant_large, ymin=quant_large-1.64*ql_se, ymax=quant_large+1.64*ql_se, color='Large Banks'), position = position_nudge(x=.2), width=.1) +
geom_point(aes(y=quant_large, color='Large Banks'), position = position_nudge(x=.2)) +
geom_errorbar(aes(y = quant_small, ymin=quant_small-1.64*qs_se, ymax=quant_small+1.64*qs_se, color='Small Banks'), position = position_nudge(x=-.2), width=.1) +
geom_point(aes(y=quant_small, color='Small Banks'), position = position_nudge(x=-.2)) +
ylab('Betas Of Quantity')
ta8[[4]] <- update(ta[[2]], .~ i(week,pppsores) + . - pppsores, data = sft, cluster='RSSD',subset= sft$LF_pre==1)
ta8[[5]] <- update(ta8[[4]], .~., subset = sft$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[6]] <- update(ta8[[4]], .~. , subset = sft$bigsmall == 0, panel.id =c('RSSD','Date'))
etable(ta8, dict=dict1,
group = list('LS2020 Controls:'=c('Offices','Ratio','Impact','lsa','rsa','dsa','Equity Cap Ratio','Log Assets',
'Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')))
ta8[[1]] <- update(ta2[[2]], .~i(week,pppsores) + . - pppsores | FED, cluster='RSSD')
ta8[[2]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[3]] <- update(ta8[[1]], .~. , subset = sf3$bigsmall == 0, panel.id =c('RSSD','Date'))
ta8[[4]] <- update(ta[[2]], .~ i(week,pppsores) + . - pppsores | FED, data = sft, cluster='RSSD')
ta8[[5]] <- update(ta8[[4]], .~., subset = sft$bigsmall == 1, panel.id =c('RSSD','Date'))
ta8[[6]] <- update(ta8[[4]], .~. , subset = sft$bigsmall == 0, panel.id =c('RSSD','Date'))
etable(ta8, dict=dict1,
group = list('LS2020 Controls:'=c('Offices','Ratio','Impact','lsa','rsa','dsa','Equity Cap Ratio','Log Assets',
'Log RA Ratio','econexpo','COVID Exposure','eci','npplsores','CI','C&I','COVID','Assets','OFFICES','age','Tier')))
plot1 <- data.table(Weeks = 1:6, prob_pooled = ta8[[1]]$coefficients[1:6], prob_large = ta8[[2]]$coefficients[1:6], prob_small = ta8[[3]]$coefficients[1:6],
quant_pooled = ta8[[4]]$coefficients[1:6], quant_large = ta8[[5]]$coefficients[1:6], quant_small = ta8[[6]]$coefficients[1:6],
pp_se = ta8[[1]]$se[1:6], pl_se = ta8[[2]]$se[1:6], ps_se = ta8[[3]]$se[1:6],
qp_se = ta8[[4]]$se[1:6], ql_se = ta8[[5]]$se[1:6], qs_se = ta8[[6]]$se[1:6])
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = prob_pooled, ymin=prob_pooled-1.64*pp_se, ymax=prob_pooled+1.64*pp_se, color='Pooled Banks'), width=.1) + geom_point(aes(y=prob_pooled, color='Pooled Banks')) +
geom_errorbar(aes(y = prob_large, ymin=prob_large-1.64*pl_se, ymax=prob_large+1.64*pl_se, color='Large Banks'), position = position_nudge(x=.2), width=.1) +
geom_point(aes(y=prob_large, color='Large Banks'), position = position_nudge(x=.2)) +
geom_errorbar(aes(y = prob_small, ymin=prob_small-1.64*ps_se, ymax=prob_small+1.64*ps_se, color='Small Banks'), position = position_nudge(x=-.2), width=.1) +
geom_point(aes(y=prob_small, color='Small Banks'), position = position_nudge(x=-.2)) +
ylab('Betas Of Probability')
ggplot(plot1, aes(x=Weeks)) +
geom_errorbar(aes(y = quant_pooled, ymin=quant_pooled-1.64*qp_se, ymax=quant_pooled+1.64*qp_se, color='Pooled Banks'), width=.1) + geom_point(aes(y=quant_pooled, color='Pooled Banks')) +
geom_errorbar(aes(y = quant_large, ymin=quant_large-1.64*ql_se, ymax=quant_large+1.64*ql_se, color='Large Banks'), position = position_nudge(x=.2), width=.1) +
geom_point(aes(y=quant_large, color='Large Banks'), position = position_nudge(x=.2)) +
geom_errorbar(aes(y = quant_small, ymin=quant_small-1.64*qs_se, ymax=quant_small+1.64*qs_se, color='Small Banks'), position = position_nudge(x=-.2), width=.1) +
geom_point(aes(y=quant_small, color='Small Banks'), position = position_nudge(x=-.2)) +
ylab('Betas Of Quantity')
temp <- subset(sf3, phase=1)
temp$DW_i
aggregate(DW_i ~ bigsmall, temp, sum)
aggregate(DW_i ~ bigsmall, temp, sum)/14
aggregate(DW_i ~ bigsmall, temp, sum)/15
aggregate(DW_i ~ bigsmall, temp, sum)/13
aggregate(DW_i ~ bigsmall, temp, sum)/16
sf4 <- aggregate(cbind(PPP, PPPLF, DW, eci, covexpo, dwbin_notest, PPPLF_ind, ppp_ind, n) ~ RSSD, sf3, sum)
setnames(sf4, old = c('dwbin_notest','PPPLF_ind','n','ppp_ind'), new = c('DW_count','LF_count','n_ppp_loans','PPP_days'))
sf4 <- left_join(sf4, aggregate(cbind(Reserves, rsa, lsa, dsa, precovdw, dwage, eqcaprat,DW_i) ~ RSSD, sf3, mean), by='RSSD')
temp <- subset(df, Date == as.Date('2019-12-31'))
temp$levrat <- temp$RCOA8274/temp$RCOAA224
temp$ci_com <- temp$RCONJ457/temp$RCON2170
temp$scisoa  <- (temp$RCON5571+temp$RCON5573+temp$RCON5575)/temp$RCON2170
temp$cdep   <- (temp$RCON2215+temp$RCON2210)/temp$RCON2170
temp$cisoa <- temp$RCON1766/temp$RCON2170
temp$levrat <- temp$RCOA8274/temp$RCOAA224
temp$liqass <- rowSums(cbind(temp$RCON0071,temp$RCON0081,temp$RCONJJ34,temp$RCON1773,temp$RCONJA22),na.rm=TRUE)/temp$RCON2170
attach(temp, warn.conflicts = F); temp$ltosb <- rowSums(cbind(RCON5570,RCON5572,RCON5574))
temp$lab_share <- temp$RIAD4135/(temp$RIAD4217 + temp$RIAD4135)
list <- c('IDRSSD','RCON2170','RCON5563','RCON5571','RCON5573','RCON5575','RCON1766','FED','levrat','Primary.ABA.Routing.Number','RCON0081','RCON0071','ltosb',
'ci_com','scisoa','cdep','cisoa','liqass','lab_share','OFFICES')
sf4 <- left_join(sf4, data.frame(temp[,list]), by=c('RSSD' = 'IDRSSD'))
#Creating the PPPE from Granja
sf4$ltosb <- ifelse(is.na(sf4$ltosb) == TRUE, 0, sf4$ltosb)
sf4$sb_share_tot <- sf4$ltosb/sum(sf4$ltosb)
sf4$ppp_share_tot <- sf4$n_ppp_loans/sum(sf4$n_ppp_loans)
sf4$pppe <- .5*(sf4$ppp_share_tot-sf4$sb_share_tot)/(sf4$ppp_share_tot+sf4$sb_share_tot)
# Creating the average length to get a PPP loan
temp <- sf3 %>% group_by(RSSD) %>% mutate(tot_ppp = sum(n))
temp$length <- as.numeric(temp$Date - as.Date('2020-04-03'))
temp$ppp_share_n <- temp$n/temp$tot_ppp
temp$avg_length <- temp$ppp_share_n*temp$length
temp <- aggregate(avg_length ~ RSSD, temp, sum)
sf4 <- left_join(sf4, temp)
sf4 <- left_join(sf4, unique(binstr[,c('IDRSSD','dep_share')]),by=c('RSSD'='IDRSSD'))
temp <- subset(dwborrow, Loan.date <= as.Date('2020-03-01')) %>% group_by(Borrower.ABA.number) %>% count()
temp$Borrower.ABA.number <- as.numeric(temp$Borrower.ABA.number)
sf4 <- left_join(sf4, temp, by=c('Primary.ABA.Routing.Number' = 'Borrower.ABA.number'))
sf4$n_DW_precov <- ifelse(is.na(sf4$n) == TRUE, 0, sf4$n)
sf4$precovdw <- ifelse(sf4$n_DW_precov >0, 1, 0)
sf4$sb_cis <- (sf4$RCON5571+sf4$RCON5573+sf4$RCON5575)/sf4$RCON1766
sf4$bigsmall <- ifelse(sf4$RCON2170 > 600000,1,0)
sf4$Reserves <- 1000*(sf4$RCON0071 + sf4$RCON0081)
sf4$size <- log(sf4$RCON2170)
sf4$pppsores <- sf4$PPP/sf4$Reserves
sf4$dwsores <- sf4$DW/sf4$Reserves
sf4$lfsores <- sf4$PPPLF/sf4$Reserves
sf4$scisoa <- ifelse(is.na(sf4$scisoa)==TRUE, 0, sf4$scisoa)
sf4$intensity <- sf4$pppsores/sf4$PPP_days
sf4$LF_i <- ifelse(sf4$PPPLF>0,1,0)
sf4$DW_i <- ifelse(sf4$DW>100000,1,0)
sf4 <- subset(sf4, PPP > 0)
sf4 <- sf4 %>% mutate(size_10 = ntile(RCON2170, 10))
list <- c('pppsores','dwsores','lfsores','eci','covexpo','rsa','lsa','dsa','OFFICES','sb_cis','n_ppp_loans','levrat',
'ci_com','scisoa','cdep','cisoa','liqass')
sf4[,list] <- lapply(sf4[,list], Winsorize, probs=c(.001,.999), na.rm = TRUE)
sf4$lab_share <- Winsorize(sf4$lab_share, minval = 0, maxval = 1)
ta <- list()
ta[[1]] <- feols( log(n_ppp_loans) ~ DW_i | FED, sf4)
ta[[2]] <- update(ta[[1]], .~. + LF_i  + log(OFFICES) + rsa + eqcaprat + eci +  cdep + cisoa + liqass + levrat + size + log(dwage) + covexpo)
ta[[3]] <- update(ta[[2]], subset = sf4$bigsmall == 1)
ta[[4]] <- update(ta[[2]], subset = sf4$bigsmall == 0)
ta[[5]] <- update(ta[[1]], avg_length ~DW_i )
ta[[6]] <- update(ta[[2]], avg_length ~. + DW_i+ log(n_ppp_loans))
ta[[7]] <- update(ta[[6]], subset = sf4$bigsmall == 1)
ta[[8]] <- update(ta[[6]], subset = sf4$bigsmall == 0)
etable(ta,dict= dict1, fitstat = ~n+r2, se='white',
headers = c('No Controls','Pooled','Large Banks', 'Small Banks'),
tex=T)
etable(ta,dict= dict1, fitstat = ~n+r2, se='white',
headers = c('No Controls','Pooled','Large Banks', 'Small Banks'),
tex=F)
