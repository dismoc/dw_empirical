panel.id = c('IDRSSD','Date'))
etable(post,pre, cluster='FED')
rm(plot1, pre, post)
rm(cov, agg)
list <- list.files(path="D:/Research/DW lending empirical/Data/SOD/", pattern=".csv")
sod <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[1]),show_col_types = FALSE))
for (i in 2:length(list)) {
sodn <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[i]),show_col_types = FALSE))
sod <- smartbind(sod,sodn)
}
base <- left_join(aggregate(DEPSUMBR ~ STALPBR + YEAR + RSSDHCR, sod, FUN = sum),
aggregate(DEPSUMBR ~ YEAR + RSSDHCR, sod, FUN = sum), by=c('RSSDHCR', 'YEAR'))
base$dep_share <- base$DEPSUMBR.x/base$DEPSUMBR.y
base <- subset(base, base$RSSDHCR >0)[,c('STALPBR','YEAR','RSSDHCR','dep_share')]
base <- spread(base, STALPBR, dep_share)
base <- left_join(base,sod[,c('RSSDHCR','CERT','YEAR')],by=c('RSSDHCR','YEAR'))
base <- base[!duplicated(base[c("RSSDHCR","YEAR")]),]
data.frame(base,rep(c('03-31','06-30','09-30','12-31')))
base <- smartbind(base,base); base <- smartbind(base,base)
base <- pdata.frame(base,index = c('RSSDHCR','YEAR'))
q <- c("/03/31","/06/30","/09/30","/12/31")
base <- data.frame(base, rep(q,nrow(base)/4))
base$Date <- as.Date(paste0(base$YEAR,base$rep.q..nrow.base..4.))
base <- pdata.frame(data.frame(base),index = c('RSSDHCR','Date'))
base <- base[ , -which(names(base) %in% c("rep.q..nrow.base..4."))]
for (i in 3:ncol(base)-1){
base[,i] <- lead(base[,i],2)
}
base$Date <- as.Date(base$Date)
base$RSSDHCR <- as.numeric(as.character(base$RSSDHCR))
sci <- data.frame(read_delim("D:/Research/DW lending empirical/Data/SOD/CI/coincident-revised.csv",show_col_types = FALSE))
sci$time <- as.Date(timeLastDayInQuarter(as.Date(sci$Date,'%m/%d/%Y')))
sci <- sci[seq(1, nrow(sci), 3), ][2:ncol(sci)]
sci
names(sci)
View(sci)
list <- names(sci)
lag(sci,1)
lag(pdata.frame(sci, 'time'),1)
diff(sci)
diff(sci$AL)
length(diff(sci$AL))
c(diff(sci$AL),NA)
i = 1
c(diff(sci[,i]),NA)
for (i in 1:ncol(sci)-1) {
sci[,i] <- c(diff(sci[,i]),NA)
}
sci[,i]
ncol(sci)-1
for (i in 1:ncol(sci)-1) {
sci[,i] <- c(diff(sci[,i]),NA)
}
i = 1
for (i in 1:ncol(sci)-1) {
sci[,i] <- c(diff(sci[,i]),NA)
}
i = 1
c(diff(sci[,i]),NA)
for (i in 1:(ncol(sci)-1)) {
sci[,i] <- c(diff(sci[,i]),NA)
}
join <- data.frame(base[,c(1:2,62:63)],
mapply("*", base[intersect(names(base), names(sci))],
sci[intersect(names(base), names(sci))]))
join <- data.frame(join[,1:4], exposure = rowSums(join[5:ncol(join)], na.rm = TRUE))
join <- join[!is.na(join$RSSDHCR),]
rm(sod, sodn, sci, base)
write.csv(join,"D:\\Research\\DW lending empirical\\Data\\sod_merged.csv")
# For Q4 2009
list <- list.files(path="D:/Research/DW lending empirical/Data/SOD/", pattern=".csv")
sod <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[1]),show_col_types = FALSE))
for (i in 2:length(list)) {
sodn <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[i]),show_col_types = FALSE))
sod <- smartbind(sod,sodn)
}
base <- left_join(aggregate(DEPSUMBR ~ STALPBR + YEAR + RSSDHCR, sod, FUN = sum),
aggregate(DEPSUMBR ~ YEAR + RSSDHCR, sod, FUN = sum), by=c('RSSDHCR', 'YEAR'))
base$dep_share <- base$DEPSUMBR.x/base$DEPSUMBR.y
base <- subset(base, base$RSSDHCR >0)[,c('STALPBR','YEAR','RSSDHCR','dep_share')]
base <- spread(base, STALPBR, dep_share)
base <- left_join(base,sod[,c('RSSDHCR','CERT','YEAR')],by=c('RSSDHCR','YEAR'))
base <- base[!duplicated(base[c("RSSDHCR","YEAR")]),]
data.frame(base,rep(c('03-31','06-30','09-30','12-31')))
base <- smartbind(base,base); base <- smartbind(base,base)
base <- pdata.frame(base,index = c('RSSDHCR','YEAR'))
q <- c("/03/31","/06/30","/09/30","/12/31")
base <- data.frame(base, rep(q,nrow(base)/4))
base$Date <- as.Date(paste0(base$YEAR,base$rep.q..nrow.base..4.))
base <- pdata.frame(data.frame(base),index = c('RSSDHCR','Date'))
base <- base[ , -which(names(base) %in% c("rep.q..nrow.base..4."))]
for (i in 3:ncol(base)-1){
base[,i] <- lead(base[,i],2)
}
base$Date <- as.Date(base$Date)
base$RSSDHCR <- as.numeric(as.character(base$RSSDHCR))
sci <- data.frame(read_delim("D:/Research/DW lending empirical/Data/SOD/CI/coincident-revised.csv",show_col_types = FALSE))
sci$time <- as.Date(timeLastDayInQuarter(as.Date(sci$Date,'%m/%d/%Y')))
sci <- sci[seq(1, nrow(sci), 3), ][2:ncol(sci)]
list <- names(sci)
for (i in 1:(ncol(sci)-1)) {
sci[,i] <- c(diff(sci[,i]),NA)
}
basebase
# For Q4 2009
list <- list.files(path="D:/Research/DW lending empirical/Data/SOD/", pattern=".csv")
sod <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[1]),show_col_types = FALSE))
for (i in 2:length(list)) {
sodn <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[i]),show_col_types = FALSE))
sod <- smartbind(sod,sodn)
}
base <- left_join(aggregate(DEPSUMBR ~ STALPBR + YEAR + RSSDHCR, sod, FUN = sum),
aggregate(DEPSUMBR ~ YEAR + RSSDHCR, sod, FUN = sum), by=c('RSSDHCR', 'YEAR'))
library(tidyverse)
library(mlr3verse)
library(plm)
library(readxl)
library(dplyr)
library('DataCombine')
library('stargazer')
library('simpleboot')
library('Rpdb')
library('data.table')
library(ggplot2)
library(gtools)
library(lubridate)
library("R.utils")
list <- list.files(path="D:/Research/DW lending empirical/Data/SOD/", pattern=".csv")
sod <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[1]),show_col_types = FALSE))
for (i in 2:length(list)) {
sodn <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[i]),show_col_types = FALSE))
sod <- smartbind(sod,sodn)
}
base <- left_join(aggregate(DEPSUMBR ~ STALPBR + YEAR + RSSDHCR, sod, FUN = sum),
aggregate(DEPSUMBR ~ YEAR + RSSDHCR, sod, FUN = sum), by=c('RSSDHCR', 'YEAR'))
base$dep_share <- base$DEPSUMBR.x/base$DEPSUMBR.y
base <- subset(base, base$RSSDHCR >0)[,c('STALPBR','YEAR','RSSDHCR','dep_share')]
base <- spread(base, STALPBR, dep_share)
base <- left_join(base,sod[,c('RSSDHCR','CERT','YEAR')],by=c('RSSDHCR','YEAR'))
base <- base[!duplicated(base[c("RSSDHCR","YEAR")]),]
data.frame(base,rep(c('03-31','06-30','09-30','12-31')))
base <- smartbind(base,base); base <- smartbind(base,base)
base <- pdata.frame(base,index = c('RSSDHCR','YEAR'))
q <- c("/03/31","/06/30","/09/30","/12/31")
base <- data.frame(base, rep(q,nrow(base)/4))
base$Date <- as.Date(paste0(base$YEAR,base$rep.q..nrow.base..4.))
base <- pdata.frame(data.frame(base),index = c('RSSDHCR','Date'))
base <- base[ , -which(names(base) %in% c("rep.q..nrow.base..4."))]
for (i in 3:ncol(base)-1){
base[,i] <- lead(base[,i],2)
}
base$Date <- as.Date(base$Date)
base$RSSDHCR <- as.numeric(as.character(base$RSSDHCR))
sci <- data.frame(read_delim("D:/Research/DW lending empirical/Data/SOD/CI/coincident-revised.csv",show_col_types = FALSE))
sci$time <- as.Date(timeLastDayInQuarter(as.Date(sci$Date,'%m/%d/%Y')))
sci <- sci[seq(1, nrow(sci), 3), ][2:ncol(sci)]
list <- names(sci)
for (i in 1:(ncol(sci)-1)) {
sci[,i] <- c(diff(sci[,i]),NA)
}
join <- data.frame(base[,c(1:2,62:63)],
mapply("*", base[intersect(names(base), names(sci))],
sci[intersect(names(base), names(sci))]))
join <- data.frame(join[,1:4], exposure = rowSums(join[5:ncol(join)], na.rm = TRUE))
join <- join[!is.na(join$RSSDHCR),]
base
base <- left_join(aggregate(DEPSUMBR ~ STALPBR + YEAR + RSSDHCR, sod, FUN = sum),
aggregate(DEPSUMBR ~ YEAR + RSSDHCR, sod, FUN = sum), by=c('RSSDHCR', 'YEAR'))
base$dep_share <- base$DEPSUMBR.x/base$DEPSUMBR.y
base <- subset(base, base$RSSDHCR >0)[,c('STALPBR','YEAR','RSSDHCR','dep_share')]
base <- spread(base, STALPBR, dep_share)
base
base <- left_join(base,sod[,c('RSSDHCR','CERT','YEAR')],by=c('RSSDHCR','YEAR'))
base <- base[!duplicated(base[c("RSSDHCR","YEAR")]),]
data.frame(base,rep(c('03-31','06-30','09-30','12-31')))
base <- base[!duplicated(base[c("RSSDHCR","YEAR")]),]
base <- smartbind(base,base); base <- smartbind(base,base)
base <- pdata.frame(base,index = c('RSSDHCR','YEAR'))
q <- c("/03/31","/06/30","/09/30","/12/31")
base <- data.frame(base, rep(q,nrow(base)/4))
base$Date <- as.Date(paste0(base$YEAR,base$rep.q..nrow.base..4.))
base <- pdata.frame(data.frame(base),index = c('RSSDHCR','Date'))
base <- base[ , -which(names(base) %in% c("rep.q..nrow.base..4."))]
for (i in 3:ncol(base)-1){
base[,i] <- lead(base[,i],2)
}
View(base)
base <- left_join(aggregate(DEPSUMBR ~ STALPBR + YEAR + RSSDHCR, sod, FUN = sum),
aggregate(DEPSUMBR ~ YEAR + RSSDHCR, sod, FUN = sum), by=c('RSSDHCR', 'YEAR'))
base$dep_share <- base$DEPSUMBR.x/base$DEPSUMBR.y
base <- subset(base, base$RSSDHCR >0)[,c('STALPBR','YEAR','RSSDHCR','dep_share')]
base <- spread(base, STALPBR, dep_share)
base <- left_join(base,sod[,c('RSSDHCR','CERT','YEAR')],by=c('RSSDHCR','YEAR'))
base <- base[!duplicated(base[c("RSSDHCR","YEAR")]),]
base <- smartbind(base,base); base <- smartbind(base,base)
base <- pdata.frame(base,index = c('RSSDHCR','YEAR'))
q <- c("/03/31","/06/30","/09/30","/12/31")
base <- data.frame(base, rep(q,nrow(base)/4))
base$Date <- as.Date(paste0(base$YEAR,base$rep.q..nrow.base..4.))
base <- pdata.frame(data.frame(base),index = c('RSSDHCR','Date'))
base <- base[ , -which(names(base) %in% c("rep.q..nrow.base..4."))]
base[seq(1, nrow(base), 4), ]
base
for (i in 3:ncol(base)-1){
base[,i] <- lead(base[,i],2)
}
base$Date <- as.Date(base$Date)
base$RSSDHCR <- as.numeric(as.character(base$RSSDHCR))
sci <- data.frame(read_delim("D:/Research/DW lending empirical/Data/SOD/CI/coincident-revised.csv",show_col_types = FALSE))
sci$time <- as.Date(timeLastDayInQuarter(as.Date(sci$Date,'%m/%d/%Y')))
sci
sci[seq(1, nrow(sci), 3), ][2:ncol(sci)]
sci <- sci[seq(1, nrow(sci), 3), ][2:ncol(sci)]
list <- names(sci)
for (i in 1:(ncol(sci)-1)) {
sci[,i] <- c(diff(sci[,i]),NA)
}
sci
join <- data.frame(base[,c(1:2,62:63)],
mapply("*", base[intersect(names(base), names(sci))],
sci[intersect(names(base), names(sci))]))
join
join <- data.frame(join[,1:4], exposure = rowSums(join[5:ncol(join)], na.rm = TRUE))
join <- join[!is.na(join$RSSDHCR),]
join
subset(join, as.Date(Date) == as.Date('2020-06-30'))
subset(join, as.Date(Date) == as.Date('2020-03-31'))
sci
View(sci)
sci
data.frame(base[,c(1:2,62:63)],
mapply("*", base[intersect(names(base), names(sci))],
sci[intersect(names(base), names(sci))]))
view(data.frame(base[,c(1:2,62:63)],
mapply("*", base[intersect(names(base), names(sci))],
sci[intersect(names(base), names(sci))])))
j1 <- data.frame(base[,c(1:2,62:63)],
mapply("*", base[intersect(names(base), names(sci))],
sci[intersect(names(base), names(sci))]))
View(j1)
base
View(base)
rowSums(base)
rowSums(base[,3:62])
rowSums(base[,3:61])
as.numeric(base[,3:61])
library(tidyverse)
library(mlr3verse)
library(plm)
library(pglm)
library(readxl)
library(dplyr)
library('DataCombine')
library('stargazer')
library('simpleboot')
library('Rpdb')
library('data.table')
library(ggplot2)
library('zoo')
library('fixest')
library('timeDate')
library('DescTools')
library('summarytools')
library(gtools)
library('fuzzyjoin')
pp <- data.frame(read_excel(paste0("D:/Research/DW lending empirical/Data/PPPLF/",list[1])))
# Reading in and merging
list <- list.files(path="D:/Research/DW lending empirical/Data/PPPLF/", pattern=".xlsx")
pp <- data.frame(read_excel(paste0("D:/Research/DW lending empirical/Data/PPPLF/",list[1])))
# Reading in and merging
list <- list.files(path="D:/Research/DW lending empirical/Data/PPPLF/", pattern=".xlsx")
pp <- data.frame(read_excel(paste0("D:/Research/DW lending empirical/Data/PPPLF/",list[1])))
pp
i = 2
ppn <- data.frame(read_excel(paste0("D:/Research/DW lending empirical/Data/PPPLF/",list[i])))
pp <- smartbind(pp,ppn) %>% select(-contains("..."))
pp <- data.frame(read_excel(paste0("D:/Research/DW lending empirical/Data/PPPLF/",list[1])))
for (i in 2:length(list)){
ppn <- data.frame(read_excel(paste0("D:/Research/DW lending empirical/Data/PPPLF/",list[i])))
pp <- smartbind(pp,ppn) %>% select(-contains("..."))
}
View(pp)
as.Date(pp$Date.Of.Maturity) - as.Date(pp$Date.Of.Advance)
ifelse(as.Date(pp$Date.Of.Maturity) - as.Date(pp$Date.Of.Advance) - 720 >= 0, as.Date(pp$Date.Of.Maturity) - as.Date(pp$Date.Of.Advance) - 720, as.Date(pp$Date.Of.Maturity) - as.Date(pp$Date.Of.Advance) -
1825)
ifelse(as.Date(pp$Date.Of.Maturity) - as.Date(pp$Date.Of.Advance) - 720 >= 0, as.Date(pp$Date.Of.Maturity) - as.Date(pp$Date.Of.Advance) - 720, as.Date(pp$Date.Of.Maturity) - as.Date(pp$Date.Of.Advance) - 1825)
as.Date(pp$Date.Of.Maturity) - as.Date(pp$Date.Of.Advance) - 720
View(pp)
as.Date(pp$Date.Of.Maturity, '%y-%m-%d') - as.Date(pp$Date.Of.Advance, '%y-%m-%d')
as.Date(pp$Date.Of.Maturity, "%Y-%m-%d") - as.Date(pp$Date.Of.Advance, "%Y-%m-%d")
as.Date(pp$Date.Of.Maturity, "%Y-%m-%d") - as.Date(pp$Date.Of.Advance, "%Y-%m-%d") - 720
difftime(pp$Date.Of.Maturity,pp$Date.Of.Advance)
difftime(pp$Date.Of.Maturity,pp$Date.Of.Advance) - 720
year(pp$Date.Of.Maturity)
as.Date(pp$Date.Of.Maturity, format = '%Y-2-%d-%m')
as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d')
as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - year(2)
as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - 2
as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2)
library(lubridate)
as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2)
datedif(pp$Date.of.Advance,as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2))
difftime(pp$Date.of.Advance,as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2))
pp$Date.of.Advance -as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2)
difftime(as.Date(pp$Date.of.Advance),as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2))
as.Date(pp$Date.of.Advance)
difftime(as.Date(pp$Date.Of.Advance),as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2))
difftime(as.Date(pp$Date.Of.Advance),as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2), days)
as.Date(pp$Date.Of.Advance)
as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2)
difftime(as.Date(pp$Date.Of.Advance),as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2), units = 'days')
ifelse(year(pp$Date.Of.Maturity) == 2022,
difftime(as.Date(pp$Date.Of.Advance),as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2), units = 'days'),
difftime(as.Date(pp$Date.Of.Advance),as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(5), units = 'days'))
descr(ifelse(year(pp$Date.Of.Maturity) == 2022,
difftime(as.Date(pp$Date.Of.Advance),as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2), units = 'days'),
difftime(as.Date(pp$Date.Of.Advance),as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(5), units = 'days')))
table(ifelse(year(pp$Date.Of.Maturity) == 2022,
difftime(as.Date(pp$Date.Of.Advance),as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2), units = 'days'),
difftime(as.Date(pp$Date.Of.Advance),as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(5), units = 'days')))
View(pp)
pp$origin_date <- ifelse(year(pp$Date.Of.Maturity) == 2022,
difftime(as.Date(pp$Date.Of.Advance),as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2), units = 'days'),
difftime(as.Date(pp$Date.Of.Advance),as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(5), units = 'days'))
pp$origin_date <- ifelse(year(pp$Date.Of.Maturity) == 2022,
as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2),
as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(5))
pp$origin_date
ifelse(year(pp$Date.Of.Maturity) == 2022,
as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2),
as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(5))
as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2)
year(pp$Date.Of.Maturity)
pp$origin_date <- as.Date(ifelse(year(pp$Date.Of.Maturity) == 2022,
as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2),
as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(5)))
pp$origin_date
pp$processing_time <- difftime(pp$Date.Of.Advance,pp$origin_date)
pp$processing_time
pp$processing_time <- difftime(pp$Date.Of.Advance,pp$origin_date, units = 'days')
pp$processing_time
as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2)
library(tidyverse)
library(mlr3verse)
library(plm)
library(pglm)
library(readxl)
library(dplyr)
library('DataCombine')
library('stargazer')
library('simpleboot')
library('Rpdb')
library('data.table')
library(ggplot2)
library('zoo')
library('fixest')
library('timeDate')
library('DescTools')
library('summarytools')
library(gtools)
library(lubridate)
library('fuzzyjoin')
library(readr)
library('ggpubr')
# Import
# Reading in and merging
list <- list.files(path="D:/Research/DW lending empirical/Data/ppp_sba/", pattern=".csv")
dfp <- read_delim(paste0("D:/Research/DW lending empirical/Data/ppp_sba/",list[1]), show_col_types = FALSE)
for (i in 2:length(list)){
dfpn <- read_delim(paste0("D:/Research/DW lending empirical/Data/ppp_sba/",list[i]), show_col_types = FALSE)
dfp <- bind_rows(dfp,dfpn) %>% select(-contains("..."))
print(i)
}
rm(dfpn)
dfp$DateApproved <- as.Date(dfp$DateApproved,'%m/%d/%Y')
ppb <- aggregate(InitialApprovalAmount ~ DateApproved, dfp, FUN = sum)
write.csv(ppb,"D:\\Research\\DW lending empirical\\Data\\ppp_daily.csv")
ppb <- read_csv("D:/Research/DW lending empirical/Data/ppp_daily.csv")
write.csv(dfp,"D:\\Research\\DW lending empirical\\Data\\ppp_full.csv")
dwborrow <- read_csv("D:/Research/DW lending empirical/Data/dwborrow.csv")
# Transformation ----
dwborrow1 <- dwborrow %>% count(Loan.date)
dwborrow <- aggregate(Loan.amount ~ Loan.date, dwborrow, FUN = sum)
dwborrow <- subset(full_join(dwborrow,dwborrow1), as.Date(Loan.date) >= as.Date('2020-01-01'))
sf <- full_join(ppb,dwborrow, by=c('DateApproved' = 'Loan.date'))
sf <- subset(sf, as.Date(DateApproved) <= as.Date('2020-10-01'))
sf <- sf[order(sf$DateApproved),]
ind <- which(is.na(sf$n) == TRUE)
for (i in 2:length(ind)) {
if (ind[i] == ind[i-1]+1) {
ind <- ind[-i]
}
print(length(ind))
}
sf[ind+1,'InitialApprovalAmount'] <- sf[ind+1,'InitialApprovalAmount'] + sf[ind,'InitialApprovalAmount']
sf <- sf[-ind,]
ind <- which(is.na(sf$n) == TRUE)
ind <- ind[1:length(ind)-1]
sf[ind+1,'InitialApprovalAmount'] <- sf[ind+1,'InitialApprovalAmount'] + sf[ind,'InitialApprovalAmount']
sf <- sf[-ind,]
ind <- which(is.na(sf$n) == TRUE)
sf[ind-1,'InitialApprovalAmount'] <- sf[ind-1,'InitialApprovalAmount'] + sf[ind,'InitialApprovalAmount']
sf <- sf[-ind,]
# Creation ----
sf$InitialApprovalAmount <- ifelse(is.na(sf$InitialApprovalAmount) == TRUE & as.Date(sf$DateApproved) <= as.Date('2020-04-02'), 0, sf$InitialApprovalAmount)
sf$InitialApprovalAmount <- ifelse(is.na(sf$InitialApprovalAmount) == TRUE & as.Date(sf$DateApproved) >= as.Date('2020-08-10'), 0, sf$InitialApprovalAmount)
sf$quant_week_avg <- rollapply(sf$InitialApprovalAmount, 5, mean, na.rm=TRUE, fill = NA, partial=4)
sf$dw_quant_avg <- rollapply(sf$Loan.amount, 5, mean, na.rm=TRUE, fill = NA, partial=4)
sf$id <- 1
sf$signal <- ifelse(as.Date(sf$DateApproved) >= as.Date('2020-03-16') & as.Date(sf$DateApproved) <= as.Date('2020-03-21'), 1, 0)
sf$preppp <- ifelse(as.Date(sf$DateApproved) <= as.Date('2020-04-02'), 0, 1)
# Figures ----
ggplot(sf) +
geom_line(aes(x = DateApproved, y = quant_week_avg/5, colour ='PPP')) +
geom_line(aes(x = DateApproved, y = dw_quant_avg, colour ='DW')) +
scale_y_continuous(name = "Moving Avg of DW Loan", sec.axis = sec_axis(~.*5, name="Moving Avg of PPP Loan")) +
labs(x="Date") + theme(legend.position = c(.9, .9))
# Figures ----
ggplot(sf) +
geom_line(aes(x = DateApproved, y = quant_week_avg/3, colour ='PPP')) +
geom_line(aes(x = DateApproved, y = dw_quant_avg, colour ='DW')) +
scale_y_continuous(name = "Moving Avg of DW Loan", sec.axis = sec_axis(~.*3, name="Moving Avg of PPP Loan")) +
labs(x="Date") + theme(legend.position = c(.9, .9))
ggplot(sf) +
geom_line(aes(x = DateApproved, y = log(quant_week_avg), colour ='PPP')) +
geom_line(aes(x = DateApproved, y = log(dw_quant_avg), colour ='DW')) +
labs(x="Date") + theme(legend.position = c(.9, .9))
ggplot(sf) +
geom_line(aes(x = DateApproved, y = log(quant_week_avg+1), colour ='PPP')) +
geom_line(aes(x = DateApproved, y = log(dw_quant_avg+1), colour ='DW')) +
labs(x="Date") + theme(legend.position = c(.9, .9))
sf$quant_week_avg <- rollapply(sf$InitialApprovalAmount, 7, mean, na.rm=TRUE, fill = NA, partial=4)
sf$dw_quant_avg <- rollapply(sf$Loan.amount, 7, mean, na.rm=TRUE, fill = NA, partial=4)
# Figures ----
ggplot(sf) +
geom_line(aes(x = DateApproved, y = quant_week_avg/3, colour ='PPP')) +
geom_line(aes(x = DateApproved, y = dw_quant_avg, colour ='DW')) +
scale_y_continuous(name = "Moving Avg of DW Loan", sec.axis = sec_axis(~.*3, name="Moving Avg of PPP Loan")) +
labs(x="Date") + theme(legend.position = c(.9, .9))
ggplot(sf) +
geom_line(aes(x = DateApproved, y = log(quant_week_avg+1), colour ='PPP')) +
geom_line(aes(x = DateApproved, y = log(dw_quant_avg+1), colour ='DW')) +
labs(x="Date") + theme(legend.position = c(.9, .9))
library(tidyverse)
library(mlr3verse)
library(plm)
library(pglm)
library(readxl)
library(dplyr)
library('DataCombine')
library('stargazer')
library('simpleboot')
library('Rpdb')
library('data.table')
library(ggplot2)
library('zoo')
library('fixest')
library('timeDate')
library('DescTools')
library('summarytools')
library(gtools)
library(lubridate)
library('fuzzyjoin')
library(readr)
ppr <- read_delim("D:/Research/DW lending empirical/Data/ppp_borrower/query_20211221_082058.csv",
delim = "|", escape_double = FALSE, trim_ws = TRUE)
8863652/11468438
rm(ppr, dfp, dwborrow, dwborrow1, sf)
# Reading in and merging
list <- list.files(path="D:/Research/DW lending empirical/Data/PPPLF/", pattern=".xlsx")
pp <- data.frame(read_excel(paste0("D:/Research/DW lending empirical/Data/PPPLF/",list[1])))
for (i in 2:length(list)){
ppn <- data.frame(read_excel(paste0("D:/Research/DW lending empirical/Data/PPPLF/",list[i])))
pp <- smartbind(pp,ppn) %>% select(-contains("..."))
}
pp <- data.frame(read_excel(paste0("D:/Research/DW lending empirical/Data/PPPLF/",list[1])))
for (i in 2:length(list)){
ppn <- data.frame(read_excel(paste0("D:/Research/DW lending empirical/Data/PPPLF/",list[i])))
pp <- smartbind(pp,ppn) %>% select(-contains("..."))
}
# Reading in and merging
list <- list.files(path="D:/Research/DW lending empirical/Data/PPPLF/", pattern=".xlsx")
pp <- data.frame(read_excel(paste0("D:/Research/DW lending empirical/Data/PPPLF/",list[1])))
for (i in 2:length(list)){
ppn <- data.frame(read_excel(paste0("D:/Research/DW lending empirical/Data/PPPLF/",list[i])))
pp <- smartbind(pp,ppn) %>% select(-contains("..."))
}
pp
pp$origin_date <- as.Date(ifelse(year(pp$Date.Of.Maturity) == 2022,
as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(2),
as.Date(pp$Date.Of.Maturity, format = '%Y-%m-%d') - years(5)))
data.frame(pp$origin_date, pp$Date.Of.Advance)
order(pp$origin_date,pp$Date.Of.Advance)
pp[order(pp$origin_date,pp$Date.Of.Advance),]
pp[49206,]
pp[!duplicated(pp[c('Date.Of.Advance','Original.Outstanding.Advance.Amount')]),]
pp <- pp[!duplicated(pp[c('Date.Of.Advance','Original.Outstanding.Advance.Amount')]),]
pp
pp[order(pp$origin_date,pp$Date.Of.Advance),]
difftime(pp$Date.Of.Advance,pp$origin_date, units = 'days')
pp$Date.Of.Advance-pp$origin_date
pp$Date.Of.Advance <- as.Date(pp$Date.Of.Advance)
pp$Date.Of.Advance-pp$origin_date
table(pp$Date.Of.Advance-pp$origin_date)
Winsorize((pp$Date.Of.Advance-pp$origin_date),probs=c(.01,.99), na.rm = TRUE)
table(Winsorize((pp$Date.Of.Advance-pp$origin_date),probs=c(.01,.99), na.rm = TRUE))
table(Winsorize((pp$Date.Of.Advance-pp$origin_date),minval=0, na.rm = TRUE))
table(Winsorize((pp$Date.Of.Advance-pp$origin_date),minval=0))
table(Winsorize((pp$Date.Of.Advance-pp$origin_date),minval=0,na.rm=TRUE))
table(Winsorize((pp$Date.Of.Advance-pp$origin_date),minval=0, probs=c(.00,1),na.rm=TRUE))
pp$processing_time <- Winsorize((pp$Date.Of.Advance-pp$origin_date),minval=0, probs=c(.00,1),na.rm=TRUE)
pp
