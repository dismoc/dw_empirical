df$qcordep_growth <- Winsorize((df$RCON2215 + df$RCON6810 + df$RCON0352 + df$RCON6648 - (lag(df$RCON2215) + lag(df$RCON6810) + lag(df$RCON0352) + lag(df$RCON6648)))/
(lag(df$RCON2215) + lag(df$RCON6810) + lag(df$RCON0352) + lag(df$RCON6648)),probs = c(0.01, 0.99), na.rm = TRUE) #core deposit growth rates
df$ci_loans <- ifelse(is.na(df$RCON1766) == TRUE, df$RCON1763+df$RCON1764, df$RCON1766)
df$ci_loans_growth <- Winsorize((ifelse(is.na(df$RCON1766) == TRUE, df$RCON1763+df$RCON1764, df$RCON1766) -
ifelse(is.na(lag(df$RCON1766)) == TRUE, lag(df$RCON1763)+lag(df$RCON1764), lag(df$RCON1766)))/
ifelse(is.na(lag(df$RCON1766)) == TRUE, lag(df$RCON1763)+lag(df$RCON1764), lag(df$RCON1766)),probs = c(0.01, 0.99), na.rm = TRUE)
df$loans <- df$RCON2122
df$loans_growth <- Winsorize((df$RCON2122 - lag(df$RCON2122))/lag(df$RCON2122),probs = c(0.01, 0.99), na.rm = TRUE)
# CAMELS - Duchin Sosyura (2014)----
# Capital Adequacy
df$ca <- Winsorize(df$RCON8274/df$RCONA223, probs=c(.01,.99),na.rm = TRUE)
#Asset quality
df$aq <- -(df$RCON1407 + df$RCON1403)/df$RCON2122
feols(int_paid_ib ~ size + age + exposure | Date + FED | dwborrow_cov ~ dwaccess_2 + l(ca) + l(aq), df)
feols(int_paid_ib ~ size + age + exposure | Date + FED | dwborrow_cov ~ dwaccess_2 + l(ca) + l(aq), dfm panel.id = c('IDRSSD','Date'))
feols(int_paid_ib ~ size + age + exposure | Date + FED | dwborrow_cov ~ dwaccess_2 + l(ca) + l(aq), data = df, panel.id = c('IDRSSD','Date'))
feols(int_paid_ib ~ size + age + exposure | Date + FED | dwborrow_cov ~ dwaccess_2 + l(ca) + l(aq) + l(roe), data = df, panel.id = c('IDRSSD','Date'))
feols(log(int_paid_ib) ~ size + age + exposure | Date + FED | dwborrow_cov ~ dwaccess_2 + l(ca) + l(aq) + l(roe), data = df, panel.id = c('IDRSSD','Date'))
feols(log(int_paid_ib) ~ size + age + exposure + int_ltd_ann + int_cd_ann + qcordep_growth + ci_loans_growth + log(loans) | Date + FED | dwborrow_cov ~ dwaccess_2 + l(ca) + l(aq) + l(roe), data = df, panel.id = c('IDRSSD','Date'))
df$int_ltd_ann <- Winsorize((df$RIADA517/df$RCONA514)*400,probs = c(0.01, 0.99), na.rm = TRUE) #interest rate, large time deposits (implicit)
df$int_cd_ann <- Winsorize(((df$RIAD4508 + df$RIAD0093)/df$RCONA514)*400,probs = c(0.01, 0.99), na.rm = TRUE) #interest rate, core deposits (implicit)
df$qdep_growth <- Winsorize((df$RCON2200-lag(df$RCON2200))/lag(df$RCON2200),probs = c(0.01, 0.99), na.rm = TRUE) #deposit growth rates
df$qcordep_growth <- Winsorize((df$RCON2215 + df$RCON6810 + df$RCON0352 + df$RCON6648 - (lag(df$RCON2215) + lag(df$RCON6810) + lag(df$RCON0352) + lag(df$RCON6648)))/
(lag(df$RCON2215) + lag(df$RCON6810) + lag(df$RCON0352) + lag(df$RCON6648)),probs = c(0.01, 0.99), na.rm = TRUE) #core deposit growth rates
df$ci_loans <- ifelse(is.na(df$RCON1766) == TRUE, df$RCON1763+df$RCON1764, df$RCON1766)
df$ci_loans_growth <- Winsorize((ifelse(is.na(df$RCON1766) == TRUE, df$RCON1763+df$RCON1764, df$RCON1766) -
ifelse(is.na(lag(df$RCON1766)) == TRUE, lag(df$RCON1763)+lag(df$RCON1764), lag(df$RCON1766)))/
ifelse(is.na(lag(df$RCON1766)) == TRUE, lag(df$RCON1763)+lag(df$RCON1764), lag(df$RCON1766)),probs = c(0.01, 0.99), na.rm = TRUE)
feols(log(int_paid_ib) ~ size + age + exposure + int_ltd_ann + int_cd_ann + qcordep_growth + ci_loans_growth + log(loans) | Date + FED | dwborrow_cov ~ dwaccess_2 + l(ca) + l(aq) + l(roe), data = df, panel.id = c('IDRSSD','Date'))
feols(log(int_paid_ib) ~ size + age + exposure + int_ltd_ann + int_cd_ann + log(loans) | Date + FED | dwborrow_cov ~ dwaccess_2 + l(ca) + l(aq) + l(roe), data = df, panel.id = c('IDRSSD','Date'))
feols(log(int_paid_ib) ~ size + age + exposure + log(loans) | Date + FED | dwborrow_cov ~ dwaccess_2 + l(ca) + l(aq) + l(roe), data = df, panel.id = c('IDRSSD','Date'))
df$t1riskrat <- df$RCON7206
df$totriskrat <- df$RCON7205
df$eqcaprat <- df$RCONG105/df$RCON2170
feols(log(int_paid_ib) ~ size + age + exposure + t1riskrat + totriskrat + eqcaprat | Date + FED | dwborrow_cov ~ dwaccess_2 + l(ca) + l(aq) + l(roe), data = df, panel.id = c('IDRSSD','Date'))
df$t1riskrat
feols(log(int_paid_ib) ~ size + age + exposure + t1riskrat + totriskrat + eqcaprat | Date + IDRSSD | dwborrow_cov ~ dwaccess_2 + l(ca) + l(aq) + l(roe), data = df, panel.id = c('IDRSSD','Date'))
feols(int_paid_ib ~ size + age + exposure + t1riskrat + totriskrat + eqcaprat | Date + IDRSSD | dwborrow_cov ~ dwaccess_2 + l(ca) + l(aq) + l(roe), data = df, panel.id = c('IDRSSD','Date'))
feols(int_paid_ib ~ size + age + exposure  | Date + IDRSSD | dwborrow_cov ~ dwaccess_2 + l(ca) + l(aq) + l(roe), data = df, panel.id = c('IDRSSD','Date'))
feols(int_paid_ib ~ size + age + exposure  | Date + IDRSSD | dwborrow_cov ~ dwaccess_2 + l(ca) + l(aq) + l(roe), data = df, panel.id = c('IDRSSD','Date'), cluster= 'FED')
feols(int_paid_ib ~ size + age + exposure + dwaccess_2 | Date + IDRSSD | dwborrow_cov ~  + l(ca) + l(aq) + l(roe), data = df, panel.id = c('IDRSSD','Date'), cluster= 'FED')
feols(int_paid_ib ~ size + age + exposure + log(borr_total) | Date + IDRSSD | dwborrow_cov ~  + l(ca) + l(aq) + l(roe), data = df, panel.id = c('IDRSSD','Date'), cluster= 'FED')
load("D:/Research/DW lending empirical/Code/.RData")
library(tidyverse)
library(mlr3verse)
library(plm)
library(pglm)
library(readxl)
library(dplyr)
library('DataCombine')
library('stargazer')
library('simpleboot')
library('Rpdb')
library('data.table')
library(ggplot2)
library('zoo')
library('fixest')
library('timeDate')
library('DescTools')
library('summarytools')
library(gtools)
library('fuzzyjoin')
library('lubridate')
feols(int_paid_ib ~ l(dw_borrow_bin) + size + age | Date + FED,
data = df, subset = Date >= 2020)
feols(int_paid_ib ~ l(dwborrow_bin) + size + age | Date + FED,
data = df, subset = Date >= 2020)
feols(int_paid_ib ~ l(dwborrow_bin) + size + age | Date + FED,
data = df, subset = Date >= 2020,
panel.id = c('IDRSSD','Date'))
feols(int_paid_ib ~ l(dwborrow_bin) + size + age | Date + FED,
data = subset(df, as.Date(Date) >= as.Date('2020-01-01')),
panel.id = c('IDRSSD','Date'))
feols(int_paid_ib ~ l(dwborrow_bin) + size + age | Date + FED,
data = subset(df, as.Date(Date) >= as.Date('2018-01-01')),
panel.id = c('IDRSSD','Date'))
feols(int_paid_ib ~ l(dwborrow_bin, 8) + size + age | Date + FED,
data = subset(df, as.Date(Date) >= as.Date('2018-01-01')),
panel.id = c('IDRSSD','Date'))
df$lent_total <- (df$RCONB987 + df$RCONB989)
df$lent_total[IsZero(df$lent_total)] = NA
df$int_paid_ib <- Winsorize(df$RIAD4020*100/(df$lent_total),probs = c(0.05, 0.95), na.rm = TRUE)
df$borr_total <- (df$RCONB993 + df$RCONB995)
df$borr_total[IsZero(df$borr_total)] = NA
df$int_got_ib <- Winsorize(df$RIAD4180*100/(df$borr_total),probs = c(0.05, 0.95), na.rm = TRUE)
feols(int_paid_ib ~ l(dwborrow_bin, 8) + size + age + exposure | Date + FED,
data = subset(df, as.Date(Date) >= as.Date('2018-01-01')),
panel.id = c('IDRSSD','Date'))
feols(int_got_ib ~ l(dwborrow_bin, 8) + size + age + exposure | Date + FED,
data = subset(df, as.Date(Date) >= as.Date('2018-01-01')),
panel.id = c('IDRSSD','Date'))
feols(dwborrow_bin ~ size + age + exposure | Date + FED,
data = subset(df, as.Date(Date) >= as.Date('2018-01-01')),
panel.id = c('IDRSSD','Date'))
feols(dwborrow_bin ~ size + age + exposure + as.factor(FED| Date,
feols(dwborrow_bin ~ size + age + exposure + as.factor(FED)| Date,
data = subset(df, as.Date(Date) >= as.Date('2018-01-01')),
panel.id = c('IDRSSD','Date'))
)
)
feols(dwborrow_bin ~ size + age + exposure + as.factor(FED)| Date,
data = subset(df, as.Date(Date) >= as.Date('2018-01-01')),
panel.id = c('IDRSSD','Date'))
feols(dwborrow_bin ~ size + age + exposure + as.factor(FED)| Date,
data = subset(df, as.Date(Date) >= as.Date('2010-01-01')),
panel.id = c('IDRSSD','Date'))
summary()
reg1 <-feols(dwborrow_bin ~ size + age + exposure + as.factor(FED)| Date,
data = subset(df, as.Date(Date) >= as.Date('2010-01-01')),
panel.id = c('IDRSSD','Date'))
summary(reg1)
reg1 <-feols(dwborrow_cov ~ size + age + exposure + as.factor(FED)| Date,
data = subset(df, as.Date(Date) >= as.Date('2020-01-01')),
panel.id = c('IDRSSD','Date'))
summary(reg1)
unique(subset(df, as.Date(Date) >= as.Date('2020-01-01'))$Date)
reg1 <-feols(dwborrow_cov ~ size + age + exposure + FED| Date,
data = subset(df, as.Date(Date) >= as.Date('2020-01-01')),
panel.id = c('IDRSSD','Date'))
summary(reg1)
reg1 <-feols(dwborrow_cov ~ size + age + exposure + i.FED| Date,
data = subset(df, as.Date(Date) >= as.Date('2020-01-01')),
panel.id = c('IDRSSD','Date'))
summary(reg1)
reg1 <-feols(dwborrow_cov ~ size + age + exposure + i(FED)| Date,
data = subset(df, as.Date(Date) >= as.Date('2020-01-01')),
panel.id = c('IDRSSD','Date'))
summary(reg1)
df1 %>% count(Date, FED)
df %>% count(Date, FED)
subset(df, as.Date(Date) >= 2020) %>% count(Date, FED)
subset(df, as.Date(Date)) >= 2020) %>% count(Date, FED)
subset(df, as.Date(Date) >= as.Date('2020-01-01') %>% count(Date, FED)
)
subset(df, as.Date(Date) >= as.Date('2020-01-01')) %>% count(Date, FED)
subset(df, as.Date(Date) >= as.Date('2020-01-01')) %>% count(Date)
df$size
aggregate(size ~ FED + Date, subset(df, as.Date(Date) >= as.Date('2020-01-01')), FUN = mean)
left_join(aggregate(size ~ FED + Date, subset(df, as.Date(Date) >= as.Date('2020-01-01')), FUN = mean), subset(df, as.Date(Date) >= as.Date('2020-01-01')) %>% count(Date, FED))
subset(df, as.Date(Date) >= as.Date('2020-01-01')) %>% count(Date, FED, dwborrow_cov)
subset(df, as.Date(Date) == as.Date('2020-03-31')) %>% count(Date, FED, dwborrow_cov)
# Graph about share of banks that borrow in each district in Q1 2020
ggplot(subset(df, as.Date(Date) == as.Date('2020-03-31')) %>% count(Date, FED, dwborrow_cov),
aes(fill = dwborrow_cov, y=n, x=FED)) + geom_bar(position="stack", stat="identity")
# Graph about share of banks that borrow in each district in Q1 2020
plot1 <- subset(df, as.Date(Date) == as.Date('2020-03-31')) %>% count(Date, FED, dwborrow_cov)
ggplot(plot1, aes(fill = dwborrow_cov, y=n, x=FED)) + geom_bar(position="stack", stat="identity")
plot1
ggplot(plot1[1:24,2:4], aes(fill = dwborrow_cov, y=n, x=FED)) + geom_bar(position="stack", stat="identity")
plot1[1:24,2:4]
ggplot(plot1[1:24,2:4], aes(fill = dwborrow_cov, y=n, x=as.factor(FED))) + geom_bar(position="stack", stat="identity")
ggplot(plot1[1:24,2:4], aes(fill = dwborrow_cov, y=n, x=as.factor(FED))) + geom_bar(position="stack")
ggplot(data.frame(plot1[1:24,2:4]), aes(fill = dwborrow_cov, y=n, x=as.factor(FED))) + geom_bar(position="stack", stat="identity")
subset(df, as.Date(Date) >= as.Date('2019-03-31')) %>% count(Date, dwborrow_bin)
feols(dwborrow_cov ~ size, df)
descr(size)
descr(df$size)
feglm(dwborrow_cov ~ size, df, family = binomial(link = "probit"), )
feglm(dwborrow_cov ~ size | IDRSSD, df, family = binomial(link = "probit"), )
feglm(dwborrow_cov ~ size + i(FED), df, family = binomial(link = "probit"), )
feglm(dwborrow_cov ~ size + i(FED) | Date, df, family = binomial(link = "probit"), )
feols(dwborrow_cov ~ size + i(FED) | Date, df)
feols(dwborrow_cov ~ size + age + exposure + i(FED) | Date, df)
feols(dwborrow_cov ~ size + age + exposure + t1riskrat + totriskrat + eqcaprat + i(FED) | Date, df)
feols(dwborrow_cov ~ size + age + exposure + t1riskrat + totriskrat + eqcaprat |FED + Date, df)
feols(dwborrow_cov ~ size + age + exposure + t1riskrat + totriskrat +  |FED + Date, df)
feols(dwborrow_cov ~ size + age + exposure + t1riskrat + totriskrat  |FED + Date, df)
feols(dwborrow_cov ~ size + age + exposure + t1riskrat   |FED + Date, df)
feols(dwborrow_cov ~ size + age + exposure    |FED + Date, df)
reg1 <-feols(dwborrow_cov ~ size + age + exposure + i(FED)| Date,
data = subset(df, as.Date(Date) >= as.Date('2020-01-01') & as.Date(Date) <= as.Date('2020-07-01') ),
panel.id = c('IDRSSD','Date'))
summary(reg1)
reg1 <-feols(dwborrow_bin ~ size + age + exposure + i(FED)| Date,
data = subset(df, as.Date(Date) >= as.Date('2020-01-01') & as.Date(Date) <= as.Date('2020-07-01') ),
panel.id = c('IDRSSD','Date'))
summary(reg1)
reg2 <-feols(dwborrow_bin ~ size + age + exposure + i(FED)| Date,
data = subset(df, as.Date(Date) <= as.Date('2020-01-01') ),
panel.id = c('IDRSSD','Date'))
etable(reg1,reg2)
descr(subset(df, as.Date(Date) >= as.Date('2020-01-01') & as.Date(Date) <= as.Date('2020-07-01') )$size)
descr(subset(df, as.Date(Date) <= as.Date('2020-01-01') )$size)
left_join(aggregate(size ~ FED + Date, subset(df, as.Date(Date) >= as.Date('2020-01-01')), FUN = mean), subset(df, as.Date(Date) >= as.Date('2020-01-01')) %>% count(Date, FED))
library(tidyverse)
library(mlr3verse)
library(plm)
library(pglm)
library(readxl)
library(dplyr)
library('DataCombine')
library('stargazer')
library('simpleboot')
library('Rpdb')
library('data.table')
library(ggplot2)
library('zoo')
library('fixest')
library('timeDate')
library('xtable')
df$asset
df$RCON2170
ifelse(df$RCON2170 >= 1000000, 'Large', 'Small')
# Share of banks large vs small that borrow during covid and 2019
df$bigsmall <- ifelse(df$RCON2170 >= 1000000, 'Large', 'Small')
subset(df, as.Date(Date) >= as.Date('2019-09-30') & dwborrow_bin == 1) %>% count(Date, bigsmall)
subset(df, as.Date(Date) >= as.Date('2019-01-30') & dwborrow_bin == 1) %>% count(Date, bigsmall)
subset(df, as.Date(Date) >= as.Date('2010-01-30') & dwborrow_bin == 1) %>% count(Date, bigsmall)
plot1 <- subset(df, as.Date(Date) >= as.Date('2010-01-30') & dwborrow_bin == 1) %>% count(Date, bigsmall)
reshape(plot1, Date, bigsmall, wide)
reshape(plot1, Date, bigsmall, direction = 'wide')
reshape(plot1, idvar = Date, timevar = bigsmall, direction = 'wide')
reshape(plot1, idvar = 'Date', timevar = 'bigsmall', direction = 'wide')
plot1 <- reshape(plot1, idvar = 'Date', timevar = 'bigsmall', direction = 'wide')[,1:3]
plot1
plot1$l_share <- plot1$n.Large/(plot1$n.Large + plot1$n.Small)
plot1
data.frame(plot1)
plot1 <- subset(df, as.Date(Date) >= as.Date('2010-01-30') & dwborrow_bin == 1) %>% count(Date, bigsmall)
plot1 <- data.frame(reshape(plot1, idvar = 'Date', timevar = 'bigsmall', direction = 'wide')[,1:3])
plot1$l_share <- plot1$n.Large/(plot1$n.Large + plot1$n.Small)
plot1
mean(plot1[1:38,4])
mean(plot1[39:40,4])
df$reserve_asset_ratio
df$reserve_asset_ratio %>% group_by(bigsmall)
df$reserve_asset_ratio %>% group_by(bigsmall, date)
df$reserve_asset_ratio %>% group_by(bigsmall, Date)
df$reserve_asset_ratio %>% group_by(Date)
aggregate(reserve_asset_ratio ~ Date + bigsmall, df)
aggregate(reserve_asset_ratio ~ Date + bigsmall, df, FUN = mean)
aggregate(reserve_asset_ratio ~ Date + bigsmall, subset(df, as.Date(Date) >= as.Date('2019-01-30')), FUN = mean)
aggregate(exposure ~ Date + bigsmall, subset(df, as.Date(Date) >= as.Date('2019-01-30')), FUN = mean)
aggregate(exposure ~ Date + bigsmall, subset(df, as.Date(Date) >= as.Date('2020-01-30')), FUN = mean)
sci <- data.frame(read_delim("D:/Research/DW lending empirical/Data/SOD/CI/coincident-revised.csv",show_col_types = FALSE))
sci
join
View(join)
View(sci)
View(sci)
View(join)
sci$time <- as.Date(timeLastDayInQuarter(as.Date(sci$Date,'%m/%d/%Y')))
sci <- sci[seq(1, nrow(sci), 3), ][2:ncol(sci)]
View(sci)
list <- list.files(path="D:/Research/DW lending empirical/Data/SOD/", pattern=".csv")
sod <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[1]),show_col_types = FALSE))
for (i in 2:length(list)) {
sodn <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[i]),show_col_types = FALSE))
sod <- smartbind(sod,sodn)
}
base <- left_join(aggregate(DEPSUMBR ~ STALPBR + YEAR + RSSDHCR, sod, FUN = sum),
aggregate(DEPSUMBR ~ YEAR + RSSDHCR, sod, FUN = sum), by=c('RSSDHCR', 'YEAR'))
base$dep_share <- base$DEPSUMBR.x/base$DEPSUMBR.y
base <- subset(base, base$RSSDHCR >0)[,c('STALPBR','YEAR','RSSDHCR','dep_share')]
base <- spread(base, STALPBR, dep_share)
base <- left_join(base,sod[,c('RSSDHCR','CERT','YEAR')],by=c('RSSDHCR','YEAR'))
base <- base[!duplicated(base[c("RSSDHCR","YEAR")]),]
data.frame(base,rep(c('03-31','06-30','09-30','12-31')))
base <- smartbind(base,base); base <- smartbind(base,base)
base <- pdata.frame(base,index = c('RSSDHCR','YEAR'))
q <- c("/03/31","/06/30","/09/30","/12/31")
base <- data.frame(base, rep(q,nrow(base)/4))
base$Date <- as.Date(paste0(base$YEAR,base$rep.q..nrow.base..4.))
base <- pdata.frame(data.frame(base),index = c('RSSDHCR','Date'))
base <- base[ , -which(names(base) %in% c("rep.q..nrow.base..4."))]
for (i in 3:ncol(base)-1){
base[,i] <- lead(base[,i],2)
}
base$Date <- as.Date(base$Date)
base$RSSDHCR <- as.numeric(as.character(base$RSSDHCR))
# Libraries ----
library(tidyverse)
library(mlr3verse)
library(plm)
library(readxl)
library(dplyr)
library('DataCombine')
library('stargazer')
library('simpleboot')
library('Rpdb')
library('data.table')
library(ggplot2)
library(gtools)
library(lubridate)
library("R.utils")
# For Q4 2009
list <- list.files(path="D:/Research/DW lending empirical/Data/SOD/", pattern=".csv")
sod <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[1]),show_col_types = FALSE))
for (i in 2:length(list)) {
sodn <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[i]),show_col_types = FALSE))
sod <- smartbind(sod,sodn)
}
base <- left_join(aggregate(DEPSUMBR ~ STALPBR + YEAR + RSSDHCR, sod, FUN = sum),
aggregate(DEPSUMBR ~ YEAR + RSSDHCR, sod, FUN = sum), by=c('RSSDHCR', 'YEAR'))
base$dep_share <- base$DEPSUMBR.x/base$DEPSUMBR.y
base <- subset(base, base$RSSDHCR >0)[,c('STALPBR','YEAR','RSSDHCR','dep_share')]
base <- spread(base, STALPBR, dep_share)
base <- left_join(base,sod[,c('RSSDHCR','CERT','YEAR')],by=c('RSSDHCR','YEAR'))
base <- base[!duplicated(base[c("RSSDHCR","YEAR")]),]
data.frame(base,rep(c('03-31','06-30','09-30','12-31')))
base <- smartbind(base,base); base <- smartbind(base,base)
base <- pdata.frame(base,index = c('RSSDHCR','YEAR'))
q <- c("/03/31","/06/30","/09/30","/12/31")
base <- data.frame(base, rep(q,nrow(base)/4))
base$Date <- as.Date(paste0(base$YEAR,base$rep.q..nrow.base..4.))
base <- pdata.frame(data.frame(base),index = c('RSSDHCR','Date'))
base <- base[ , -which(names(base) %in% c("rep.q..nrow.base..4."))]
for (i in 3:ncol(base)-1){
base[,i] <- lead(base[,i],2)
}
base$Date <- as.Date(base$Date)
base$RSSDHCR <- as.numeric(as.character(base$RSSDHCR))
base
mapply("*", base[3:61], sci)
base[3:61]
sci
0.9126801*85.04
mapply("*", base[intersect(names(base), names(sci))],
sci[intersect(names(base), names(sci))])
sci <- data.frame(read_delim("D:/Research/DW lending empirical/Data/SOD/CI/coincident-revised.csv",show_col_types = FALSE))
sci$time <- as.Date(timeLastDayInQuarter(as.Date(sci$Date,'%m/%d/%Y')))
sci <- sci[seq(1, nrow(sci), 3), ][2:ncol(sci)]
join <- data.frame(base[,c(1:2,62:63)],
mapply("*", base[intersect(names(base), names(sci))],
sci[intersect(names(base), names(sci))]))
join <- data.frame(join[,1:4], exposure = rowSums(join[5:ncol(join)], na.rm = TRUE))
join <- join[!is.na(join$RSSDHCR),]
join
descr(join$exposure)
library('summarytools')
descr(join$exposure)
rm(sod, sodn, sci, base)
write.csv(join,"D:\\Research\\DW lending empirical\\Data\\sod_merged.csv")
df$cert
df[, -select %in% c('exposure')]
df[, select(-contains("exposure"))]
select(df, -contains('exposure'))
df<- select(df, -contains('exposure'))
df$cert
is.numeric(df$cert)
left_join(df, join, by= c('cert' = 'CERT', 'Date'))
join$CERT <- as.numeric(join$CERT)
left_join(df, join, by= c('cert' = 'CERT', 'Date'))
as.Date(join$Date)
join$Date <- as.Date(join$Date)
left_join(df, join, by= c('cert' = 'CERT', 'Date'))
df$Date
as.Date(df$Date)
df$Date <- as.Date(df$Date)
left_join(df, join, by= c('cert' = 'CERT', 'Date'))
class(df$Date)
class(join$Date)
left_join(data.frame(df), data.frame(join), by= c('cert' = 'CERT', 'Date'))
class(df$cert)
class(join$CERT)
library(tidyverse)
library(mlr3verse)
library(plm)
library(pglm)
library(readxl)
library(dplyr)
library('DataCombine')
library('stargazer')
library('simpleboot')
library('Rpdb')
library('data.table')
library(ggplot2)
library('zoo')
library('fixest')
library('timeDate')
library('lubridate')
effr <- read_csv("D:/Research/DW lending empirical/Data/effr_range.csv")
dwborrow <- read_csv("D:/Research/DW lending empirical/Data/dwborrow.csv")
call_rep <- read_csv("D:/Research/DW lending empirical/Data/call_rep_full.csv")
int_rate <- read_excel("D:/Research/DW lending empirical/Data/int_rates.xls")
sdc <- read_csv("D:/Research/DW lending empirical/Data/sdc_full.csv")
def <- read_csv("D:/Research/DW lending empirical/Data/defs.csv")
inst <-read_csv("D:/Research/DW lending empirical/Data/INSTITUTIONS2.CSV")
att <- read_csv("D:/Research/DW lending empirical/Data/ffiec/Atrributes_merged.csv")
int_rate$Date <- as.Date(int_rate$Date)
q <- c("0331","0630","0930","1231")
y <- c("2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")
dwbsub <- subset(dwborrow, Type.of.credit == "Primary Credit")
dwbsub <- subset(dwbsub, dwbsub$Loan.amount >= 1000000)
dwbsub$Date <- data.frame(timeLastDayInQuarter(dwbsub$Loan.date, format = "%Y-%m-%d", zone = "", FinCenter = ""))$GMT.x..i..
dwbsub$repay <- (dwbsub$Interest.rate*dwbsub$Term/36000)*dwbsub$Loan.amount
dcomb <- merge(merge(aggregate(Term ~ Borrower.ABA.number + Date, data = dwbsub, FUN = sum),
aggregate(Loan.amount*Term ~ Borrower.ABA.number + Date, data = dwbsub, FUN = sum)),
aggregate(repay ~ Borrower.ABA.number + Date, data = dwbsub, FUN = sum))
rm(dwbsub, dwborrow)
dcomb$avg.int <- 36000*dcomb$repay/dcomb$`Loan.amount * Term`
setnames(dcomb, old = c('Borrower.ABA.number','Date','Term','Loan.amount * Term','repay','avg.int'),
new = c('ABA_routing','Date','dw_freq','dw_quant','repay','avg_int'))
dcomb$ABA_routing <- as.numeric(dcomb$ABA_routing)
att$ABA_routing <- att$ID_ABA_PRIM; att$IDRSSD <- att$`#ID_RSSD`
dc <- left_join(dcomb, att[,c('ABA_routing','IDRSSD','D_DT_START','ID_FDIC_CERT','ID_OCC')], by = c('ABA_routing'))
inst$IDRSSD <- inst$FED_RSSD
df <- call_rep %>% left_join(inst[,c('FED','FDICREGN','IDRSSD','OFFICES','BKCLASS','OFFDOM','OFFFOR','STMULT','CHRTAGNT','ESTYMD')], by=('IDRSSD'),
suffix = c("",".y")) %>% select(-ends_with(".y"), -contains("..."))
df <- df %>% full_join(sdc, by=c('IDRSSD','Date'), suffix = c("",".y")) %>% select(-ends_with(".y"), -contains("..."))
rm(sdc)
df <- df %>% left_join(dc, by=c('IDRSSD','Date'), suffix = c("",".y")) %>% select(-ends_with(".y"), -contains("..."))
rm(dc, dcomb, att)
rm(inst, call_rep)
# Adding new columns ----
# Two types of access definition, dwaccess_2 is access after first loan, dwaccess_1 is access for all sample time period
#dwaccess_1
ag <- aggregate(dw_freq ~ IDRSSD, data=df, FUN = sum, na.rm = TRUE)
setnames(ag, old=c('dw_freq'), new=c('freq'))
df1 <- left_join(df, ag)
df1$dwaccess_1 <- ifelse(df1$freq > 0, 1, 0)
df1$dwaccess_1[is.na(df1$dwaccess_1)] = 0
df1 <- df1[ , -which(names(df1) %in% c("freq"))]
df <- df1
rm(df1,ag)
#dwaccess_2
df1 = df %>%
arrange(IDRSSD,Date) %>%
group_by(IDRSSD) %>%
mutate(agg_access =rollapplyr(dw_freq, 60, sum, partial = TRUE, na.rm = TRUE) )
df1$dwaccess_2 <- ifelse(df1$agg_access > 0, 1, 0)
df1 <- df1[ , -which(names(df1) %in% c("agg_access"))]
df <- df1
rm(df1)
#Adding additional series - reserve asset ratio and reserve deposit ratio,
df$dw_freq[is.na(df$dw_freq)] <- 0
df$dwborrow_bin <- ifelse(df$dw_freq > 0, 1, 0)
df$reserve_asset_ratio <- df$RCON0010/df$RCON2170
df$reserve_deposit_ratio <- df$RCON0010/df$RCON2215
df$dwborrow_cov <- ifelse(df$dwborrow_bin == 1 & as.Date(df$Date) >= as.Date('2020-03-31'), 1, 0)
rm(effr, int_rate)
# Important Info
df$bigsmall <- ifelse(df$RCON2170 >= 1000000, 'Large', 'Small')
# CAMELS - Duchin Sosyura (2014)----
# Capital Adequacy
df$ca <- Winsorize(df$RCON8274/df$RCONA223, probs=c(.01,.99),na.rm = TRUE)
#Asset quality
df$aq <- -(df$RCON1407 + df$RCON1403)/df$RCON2122
# Capital ratios - Duchin Sosyura (2014) ----
df$t1riskrat <- df$RCON7206
df$totriskrat <- df$RCON7205
df$eqcaprat <- df$RCONG105/df$RCON2170
# Bank fundamentals - Duchin Sosyura (2014) ----
df$size <- Winsorize(log(df$RCON2170),probs=c(.01,.99), na.rm = TRUE)
df$age <- year(df$Date) - year(df$ESTYMD)
join <- read_csv("D:/Research/DW lending empirical/Data/sod_merged.csv")
join$CERT <- as.numeric(join$CERT)
join$Date <- as.Date(join$Date)
df$Date <- as.Date(df$Date)
df <- left_join(data.frame(df), data.frame(join), by= c('cert' = 'CERT', 'Date'))
df$lent_total <- (df$RCONB987 + df$RCONB989)
df$lent_total[IsZero(df$lent_total)] = NA
df$int_paid_ib <- Winsorize(df$RIAD4020*100/(df$lent_total),probs = c(0.05, 0.95), na.rm = TRUE)
df$borr_total <- (df$RCONB993 + df$RCONB995)
df$borr_total[IsZero(df$borr_total)] = NA
df$int_got_ib <- Winsorize(df$RIAD4180*100/(df$borr_total),probs = c(0.05, 0.95), na.rm = TRUE)
# Library ----
library(tidyverse)
library(mlr3verse)
library(plm)
library(pglm)
library(readxl)
library(dplyr)
library('DataCombine')
library('stargazer')
library('simpleboot')
library('Rpdb')
library('data.table')
library(ggplot2)
library('zoo')
library('fixest')
library('timeDate')
library('DescTools')
library('summarytools')
library(gtools)
library('fuzzyjoin')
library('lubridate')
df$int_paid_ib <- Winsorize(df$RIAD4020*100/(df$lent_total),probs = c(0.05, 0.95), na.rm = TRUE)
df$lent_total <- (df$RCONB987 + df$RCONB989)
df$lent_total[IsZero(df$lent_total)] = NA
df$int_paid_ib <- Winsorize(df$RIAD4020*100/(df$lent_total),probs = c(0.05, 0.95), na.rm = TRUE)
df$borr_total <- (df$RCONB993 + df$RCONB995)
df$borr_total[IsZero(df$borr_total)] = NA
df$int_got_ib <- Winsorize(df$RIAD4180*100/(df$borr_total),probs = c(0.05, 0.95), na.rm = TRUE)
# Dependent variables from Acharya Mora (2015) ----
df$int_ltd_ann <- Winsorize((df$RIADA517/df$RCONA514)*400,probs = c(0.01, 0.99), na.rm = TRUE) #interest rate, large time deposits (implicit)
df$int_cd_ann <- Winsorize(((df$RIAD4508 + df$RIAD0093)/df$RCONA514)*400,probs = c(0.01, 0.99), na.rm = TRUE) #interest rate, core deposits (implicit)
df$qdep_growth <- Winsorize((df$RCON2200-lag(df$RCON2200))/lag(df$RCON2200),probs = c(0.01, 0.99), na.rm = TRUE) #deposit growth rates
df$qcordep_growth <- Winsorize((df$RCON2215 + df$RCON6810 + df$RCON0352 + df$RCON6648 - (lag(df$RCON2215) + lag(df$RCON6810) + lag(df$RCON0352) + lag(df$RCON6648)))/
1664312391961:(lag(df$RCON2215) + lag(df$RCON6810) + lag(df$RCON0352) + lag(df$RCON6648)),probs = c(0.01, 0.99), na.rm = TRUE) #core deposit growth rates
df$ci_loans <- ifelse(is.na(df$RCON1766) == TRUE, df$RCON1763+df$RCON1764, df$RCON1766)
df$ci_loans_growth <- Winsorize((ifelse(is.na(df$RCON1766) == TRUE, df$RCON1763+df$RCON1764, df$RCON1766) -
1664312394379:ifelse(is.na(lag(df$RCON1766)) == TRUE, lag(df$RCON1763)+lag(df$RCON1764), lag(df$RCON1766)))/
1664312394381:ifelse(is.na(lag(df$RCON1766)) == TRUE, lag(df$RCON1763)+lag(df$RCON1764), lag(df$RCON1766)),probs = c(0.01, 0.99), na.rm = TRUE)
df$loans <- df$RCON2122
df$loans_growth <- Winsorize((df$RCON2122 - lag(df$RCON2122))/lag(df$RCON2122),probs = c(0.01, 0.99), na.rm = TRUE)
df$loans_growth
df$coredep
df$qdep_growth
# Comparing exposure to local economic condition (measured by Philly coincident index) between large and small banks
subset(df, as.Date(Date) >= as.Date('2019-09-30') & dwborrow_bin == 1) %>% count(Date, bigsmall)
# Comparing exposure to local economic condition (measured by Philly coincident index) between large and small banks
aggregate(exposure ~ Date + dwborrow_bin, subset(df, as.Date(Date) >= as.Date('2019-09-30')), FUN = mean)
feols(dwborrow_bin ~ exposure, df)
feols(dwborrow_bin ~ exposure | IDRSSD + Date, df)
feols(dwborrow_bin ~ exposure | IDRSSD, df)
feols(dwborrow_bin ~ exposure | Date, df)
feols(dwborrow_bin ~ age+size+exposure | Date, df)
# Bank fundamentals - Duchin Sosyura (2014) ----
df$size <- Winsorize(log(df$RCON2170),probs=c(.01,.99), na.rm = TRUE)
feols(dwborrow_bin ~ age+size+exposure | Date, df)
feols(dwborrow_bin*100 ~ age+size+exposure | Date, df)
