df$qdep_growth <- Winsorize((df$RCON2200-lag(df$RCON2200))/lag(df$RCON2200),probs = c(0.01, 0.99), na.rm = TRUE) #deposit growth rates
df$qcordep_growth <- Winsorize((df$RCON2215 + df$RCON6810 + df$RCON0352 + df$RCON6648 - (lag(df$RCON2215) + lag(df$RCON6810) + lag(df$RCON0352) + lag(df$RCON6648)))/
1664312391961:(lag(df$RCON2215) + lag(df$RCON6810) + lag(df$RCON0352) + lag(df$RCON6648)),probs = c(0.01, 0.99), na.rm = TRUE) #core deposit growth rates
df$ci_loans <- ifelse(is.na(df$RCON1766) == TRUE, df$RCON1763+df$RCON1764, df$RCON1766)
df$ci_loans_growth <- Winsorize((ifelse(is.na(df$RCON1766) == TRUE, df$RCON1763+df$RCON1764, df$RCON1766) -
1664312394379:ifelse(is.na(lag(df$RCON1766)) == TRUE, lag(df$RCON1763)+lag(df$RCON1764), lag(df$RCON1766)))/
1664312394381:ifelse(is.na(lag(df$RCON1766)) == TRUE, lag(df$RCON1763)+lag(df$RCON1764), lag(df$RCON1766)),probs = c(0.01, 0.99), na.rm = TRUE)
df$loans <- df$RCON2122
df$loans_growth <- Winsorize((df$RCON2122 - lag(df$RCON2122))/lag(df$RCON2122),probs = c(0.01, 0.99), na.rm = TRUE)
# CAMELS - Duchin Sosyura (2014)----
# Capital Adequacy
df$ca <- Winsorize(df$RCON8274/df$RCONA223, probs=c(.01,.99),na.rm = TRUE)
#Asset quality
df$aq <- -(df$RCON1407 + df$RCON1403)/df$RCON2122
# Capital ratios - Duchin Sosyura (2014) ----
df$t1riskrat <- df$RCON7206
df$totriskrat <- df$RCON7205
df$eqcaprat <- df$RCONG105/df$RCON2170
# Bank fundamentals - Duchin Sosyura (2014) ----
df$size <- Winsorize(log(df$RCON2170),probs=c(.01,.99), na.rm = TRUE)
df$age <- year(df$Date) - year(df$ESTYMD)
join <- read_csv("D:/Research/DW lending empirical/Data/sod_merged.csv")
join$CERT <- as.numeric(join$CERT)
join$Date <- as.Date(join$Date)
df$Date <- as.Date(df$Date)
df <- left_join(data.frame(df), data.frame(join), by= c('cert' = 'CERT', 'Date'))
df$lent_total <- (df$RCONB987 + df$RCONB989)
df$lent_total[IsZero(df$lent_total)] = NA
df$int_paid_ib <- Winsorize(df$RIAD4020*100/(df$lent_total),probs = c(0.05, 0.95), na.rm = TRUE)
df$borr_total <- (df$RCONB993 + df$RCONB995)
df$borr_total[IsZero(df$borr_total)] = NA
df$int_got_ib <- Winsorize(df$RIAD4180*100/(df$borr_total),probs = c(0.05, 0.95), na.rm = TRUE)
rm(join)
conv <- data.frame(Name = unique(dwborrow$Lending.Federal.Reserve.district), FED = as.numeric(str_extract(unique(dwborrow$Lending.Federal.Reserve.district), "[[:digit:]]+")))
cov <- subset(df, as.Date(df$Date) >= as.Date('2019-03-31') & as.Date(df$Date) <= as.Date('2020-06-30'))
cov <- subset(df, as.Date(df$Date) >= as.Date('2019-03-31') & as.Date(df$Date) <= as.Date('2020-09-31'))
plot1 <- cov %>% count(Date, dwborrow_bin)
ggplot(data.frame(plot1), aes(fill=dwborrow_bin, y=n, x=Date)) +
geom_bar(position="stack", stat="identity")
plot1
cov <- subset(df, as.Date(df$Date) >= as.Date('2019-03-31') & as.Date(df$Date) <= as.Date('2020-09-30'))
cov
unique(cov$Date)
plot1 <- cov %>% count(Date, dwborrow_bin)
ggplot(data.frame(plot1), aes(fill=dwborrow_bin, y=n, x=Date)) +
geom_bar(position="stack", stat="identity")
plot1 <- subset(df, as.Date(Date) == as.Date('2020-03-31')) %>% count(Date, FED, dwborrow_cov)
ggplot(data.frame(plot1[1:24,2:4]), aes(fill = dwborrow_cov, y=n, x=as.factor(FED))) + geom_bar(position="stack", stat="identity")
# Graph about share of banks that borrow in each district in Q1 2020 ====
plot1 <- subset(df, as.Date(Date) == as.Date('2020-06-30')) %>% count(Date, FED, dwborrow_cov)
ggplot(data.frame(plot1[1:24,2:4]), aes(fill = dwborrow_cov, y=n, x=as.factor(FED))) + geom_bar(position="stack", stat="identity")
plot1
plot1 <- data.frame(reshape(plot1, idvar='FED', timevar = 'dwborrow_cov', direction='wide'))
plot1
plot1$borrow_share <- plot1$n.1/(plot1$n.0+plot1$n.1)
plot1
ggplot(data.frame(plot1[1:12,c(1,5)]), aes(y=borrow_share, x=as.factor(FED))) + geom_bar()
plot1$borrow_share <- plot1$n.1/(plot1$n.0+plot1$n.1)
ggplot(data.frame(plot1[1:12,c(1,5)]), aes(y=borrow_share, x=as.factor(FED))) + geom_bar()
data.frame(plot1[1:12,c(1,5)])
data.frame(plot1[1:12,c(1,6)])
ggplot(data.frame(plot1[1:12,c(1,6)]), aes(y=borrow_share, x=as.factor(FED))) + geom_bar()
ggplot(data.frame(plot1[1:12,c(1,6)]), aes(y=borrow_share, x=as.factor(FED))) + geom_point()
ggplot(data.frame(plot1[1:12,c(1,6)]), aes(x=as.factor(FED))) + geom_point()
ggplot(data.frame(plot1[1:12,c(1,6)]), aes(x=as.factor(FED))) + geom_bar()
plot1[1:12,c(1,6)]
ggplot(data.frame(plot1[1:12,c(1,6)]), aes(x=as.factor(FED), y = borrow_share) + geom_col()
ggplot(data.frame(plot1[1:12,c(1,6)]), aes(x=as.factor(FED), y = borrow_share)) + geom_col()
ggplot(data.frame(plot1[1:12,c(1,6)]), aes(x=as.factor(FED), y = borrow_share)) + geom_col()
# Graph about share of banks that borrow in each district in Q1 2020 ====
plot1 <- subset(df, as.Date(Date) == as.Date('2020-03-31')) %>% count(Date, FED, dwborrow_cov)
plot1 <- data.frame(reshape(plot1, idvar='FED', timevar = 'dwborrow_cov', direction='wide'))
plot1$borrow_share <- plot1$n.1/(plot1$n.0+plot1$n.1)
ggplot(data.frame(plot1[1:12,c(1,6)]), aes(x=as.factor(FED), y = borrow_share)) + geom_col()
# Graph about share of banks that borrow in each district in Q1 2020 ====
plot1 <- subset(df, as.Date(Date) == as.Date('2020-06-30')) %>% count(Date, FED, dwborrow_cov)
plot1 <- data.frame(reshape(plot1, idvar='FED', timevar = 'dwborrow_cov', direction='wide'))
plot1$borrow_share <- plot1$n.1/(plot1$n.0+plot1$n.1)
ggplot(data.frame(plot1[1:12,c(1,6)]), aes(x=as.factor(FED), y = borrow_share)) + geom_col()
# Graph about share of banks that borrow in each district in Q1 2020 ====
plot1 <- subset(df, as.Date(Date) == as.Date('2020-09-30')) %>% count(Date, FED, dwborrow_cov)
plot1 <- data.frame(reshape(plot1, idvar='FED', timevar = 'dwborrow_cov', direction='wide'))
plot1$borrow_share <- plot1$n.1/(plot1$n.0+plot1$n.1)
ggplot(data.frame(plot1[1:12,c(1,6)]), aes(x=as.factor(FED), y = borrow_share)) + geom_col()
# Graph about share of banks that borrow in each district in Q1 2020 ====
plot1 <- subset(df, as.Date(Date) == as.Date('2019-12-31')) %>% count(Date, FED, dwborrow_cov)
plot1 <- data.frame(reshape(plot1, idvar='FED', timevar = 'dwborrow_cov', direction='wide'))
plot1$borrow_share <- plot1$n.1/(plot1$n.0+plot1$n.1)
ggplot(data.frame(plot1[1:12,c(1,6)]), aes(x=as.factor(FED), y = borrow_share)) + geom_col()
plot1 <- data.frame(reshape(plot1, idvar='FED', timevar = 'dwborrow_bin', direction='wide'))
plot1$borrow_share <- plot1$n.1/(plot1$n.0+plot1$n.1)
ggplot(data.frame(plot1[1:12,c(1,6)]), aes(x=as.factor(FED), y = borrow_share)) + geom_col()
# Graph about share of banks that borrow in each district in Q1 2020 ====
plot1 <- subset(df, as.Date(Date) == as.Date('2019-12-31')) %>% count(Date, FED, dwborrow_bin)
plot1 <- data.frame(reshape(plot1, idvar='FED', timevar = 'dwborrow_bin', direction='wide'))
plot1$borrow_share <- plot1$n.1/(plot1$n.0+plot1$n.1)
ggplot(data.frame(plot1[1:12,c(1,6)]), aes(x=as.factor(FED), y = borrow_share)) + geom_col()
# Graph about share of banks that borrow in each district in Q1 2020 ====
plot1 <- subset(df, as.Date(Date) == as.Date('2019-09-30')) %>% count(Date, FED, dwborrow_bin)
plot1 <- data.frame(reshape(plot1, idvar='FED', timevar = 'dwborrow_bin', direction='wide'))
plot1$borrow_share <- plot1$n.1/(plot1$n.0+plot1$n.1)
ggplot(data.frame(plot1[1:12,c(1,6)]), aes(x=as.factor(FED), y = borrow_share)) + geom_col()
# Graph about share of banks that borrow in each district in Q1 2020 ====
plot1 <- subset(df, as.Date(Date) == as.Date('2019-06-30')) %>% count(Date, FED, dwborrow_bin)
plot1 <- data.frame(reshape(plot1, idvar='FED', timevar = 'dwborrow_bin', direction='wide'))
plot1$borrow_share <- plot1$n.1/(plot1$n.0+plot1$n.1)
ggplot(data.frame(plot1[1:12,c(1,6)]), aes(x=as.factor(FED), y = borrow_share)) + geom_col()
# Comparing exposure to local economic condition (measured by Philly coincident index) between large and small banks
aggregate(exposure ~ Date + dwborrow_bin, subset(df, as.Date(Date) >= as.Date('2019-09-30')), FUN = mean)
aggregate(RCON2200 ~ Date, df)
aggregate(RCON2200 ~ Date, df, FUN = sum)
aggregate(reserve_deposit_ratio ~ Date, df, FUN = sum)
df$reserve_deposit_ratio <- df$RCON0010/df$RCON2200
descr(df$reserve_deposit_ratio)
df[is.infinite(df$reserve_deposit_ratio),c('reserve_deposit_ratio')] <- NA
descr(df$reserve_deposit_ratio)
df$reserve_deposit_ratio <- Winsorize(df$reserve_deposit_ratio, probs = c(.01,.99), na.rm = TRUE)
descr(df$reserve_deposit_ratio)
aggregate(reserve_deposit_ratio ~ Date, df, FUN = sum)
aggregate(reserve_deposit_ratio ~ Date, df, FUN = mean)
library(tidyverse)
library(mlr3verse)
library(plm)
library(pglm)
library(readxl)
library(dplyr)
library('DataCombine')
library('stargazer')
library('simpleboot')
library('Rpdb')
library('data.table')
library(ggplot2)
library('zoo')
library('fixest')
library('timeDate')
library('xtable')
agg <- left_join(left_join(left_join(left_join(aggregate(RCON0010 ~ Date + FED, cov, FUN = sum),
aggregate(RCON2170 ~ Date + FED, cov, FUN = sum)),
aggregate(dw_quant ~ Date + FED, cov, FUN = sum)),
setnames(aggregate(RCON0010 ~ Date, cov, FUN = sum), old='RCON0010',new='total_asset')),
setnames(aggregate(dw_quant ~ Date, cov, FUN = sum), old='dw_quant',new='total_borrow'))
agg$total_borrow <- agg$total_borrow/1000; agg$dw_quant <- agg$dw_quant/1000
agg$'Asset Share' <- agg$RCON0010/agg$total_asset
agg$'Borrow Share' <- agg$dw_quant/agg$total_borrow
agg <- pdata.frame(agg, c('FED', 'Date'))
agg$bs_fd <- agg$Borrow.Share - lag(agg$Borrow.Share)
agg$abs_diff <- agg$dw_quant/lag(agg$dw_quant)
agg <- subset(agg, as.Date(agg$Date) == as.Date('2020-03-31'))
agg$FED <- as.numeric(agg$FED)
agg <- left_join(agg, conv)
agg <- data.frame(agg[,c('Name','bs_fd','abs_diff')])
# Print the table displaying the changes in shares.
print(xtable(data.frame(agg), type = "latex", include.rownames=FALSE))
# total size frequency borrowed over the three quarters
ggplot(agg[1:3,c(1,7)], aes(x=as.Date(Date), y=total_borrow)) +
geom_bar(stat = "identity") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
xlab("District") + ylab("Quantity")
agg <- left_join(left_join(left_join(left_join(aggregate(RCON0010 ~ Date + FED, cov, FUN = sum),
aggregate(RCON2170 ~ Date + FED, cov, FUN = sum)),
aggregate(dw_freq ~ Date + FED, cov, FUN = sum)),
setnames(aggregate(RCON0010 ~ Date, cov, FUN = sum), old='RCON0010',new='total_asset')),
setnames(aggregate(dw_freq ~ Date, cov, FUN = sum), old='dw_freq',new='total_borrow'))
agg$'Asset Share' <- agg$RCON0010/agg$total_asset
agg$'Borrow Share' <- agg$dw_freq/agg$total_borrow
# total size frequency borrowed over the three quarters
ggplot(agg[1:3,c(1,7)], aes(x=as.Date(Date), y=total_borrow)) +
geom_bar(stat = "identity") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
xlab("District") + ylab("Quantity")
agg
plot1 <- cov %>% count(Date, dwborrow_bin)
ggplot(data.frame(plot1), aes(fill=dwborrow_bin, y=n, x=Date)) +
geom_bar(position="stack", stat="identity")
# Graph about share of banks that borrow in each district in Q1 2020 ====
plot1 <- subset(df, as.Date(Date) == as.Date('2019-06-30')) %>% count(Date, FED, dwborrow_bin)
plot1 <- data.frame(reshape(plot1, idvar='FED', timevar = 'dwborrow_bin', direction='wide'))
plot1$borrow_share <- plot1$n.1/(plot1$n.0+plot1$n.1)
ggplot(data.frame(plot1[1:12,c(1,6)]), aes(x=as.factor(FED), y = borrow_share)) + geom_col()
# Share of banks that borrow went from .9% in Q42019 to 4.5% in Q1 2020 and 4% in Q2 2020.
subset(df, as.Date(Date) >= as.Date('2019-03-31')) %>% count(Date, dwborrow_bin)
# Share of banks that borrow went from .9% in Q42019 to 4.5% in Q1 2020 and 4% in Q2 2020.
reshape(subset(df, as.Date(Date) >= as.Date('2019-03-31')) %>% count(Date, dwborrow_bin), idvar = 'Date', timevar = 'dwborrow_bin', direction = 'wide')
# Share of banks that borrow went from .9% in Q42019 to 4.5% in Q1 2020 and 4% in Q2 2020.
plot1 <- reshape(subset(df, as.Date(Date) >= as.Date('2019-03-31')) %>% count(Date, dwborrow_bin), idvar = 'Date', timevar = 'dwborrow_bin', direction = 'wide')
plot1$borrow_share <- plot1$n.1/(plot1$n.1 + plot1$n.0)
plot1
ggplot(plot1, aes(x=Date, y=borrow_share)) + geom_line()
# Share of banks large vs small that borrow during covid and 2019 (MEAN OF 2010-2019: .385 LARGE BANK SHARE, MEAN OF 2020: .61)
plot1 <- subset(df, as.Date(Date) >= as.Date('2010-01-30') & dwborrow_bin == 1) %>% count(Date, bigsmall)
plot1 <- data.frame(reshape(plot1, idvar = 'Date', timevar = 'bigsmall', direction = 'wide')[,1:3])
plot1$l_share <- plot1$n.Large/(plot1$n.Large + plot1$n.Small)
plot1
data.frame(plo1t)
data.frame(plot1)
mean(plot1[1:38,4])
mean(plot1[39:41,4])
mean(plot1[39:40,4])
View(plot1)
# Comparing exposure to local economic condition (measured by Philly coincident index) between large and small banks
aggregate(exposure ~ Date + dwborrow_bin, subset(df, as.Date(Date) >= as.Date('2019-09-30')), FUN = mean)
# 1 SD change in size during covid led to 6% increase in borrowing prob, 1 SD change in size pre-covid led to a 1% increase in borrowing prob.
reg1 <-feols(dwborrow_bin ~ size + age + exposure + i(FED)| Date,
data = subset(df, as.Date(Date) >= as.Date('2020-01-01') & as.Date(Date) <= as.Date('2020-07-01') ),
panel.id = c('IDRSSD','Date'))
reg2 <-feols(dwborrow_bin ~ size + age + exposure + i(FED)| Date,
data = subset(df, as.Date(Date) <= as.Date('2020-01-01') ),
panel.id = c('IDRSSD','Date'))
etable(reg1,reg2)
# 1 SD change in size during covid led to 6% increase in borrowing prob, 1 SD change in size pre-covid led to a 1% increase in borrowing prob.
reg1 <-feols(dwborrow_bin ~ size + age + exposure + ca + aq + i(FED)| Date,
data = subset(df, as.Date(Date) >= as.Date('2020-01-01') & as.Date(Date) <= as.Date('2020-07-01') ),
panel.id = c('IDRSSD','Date'))
reg2 <-feols(dwborrow_bin ~ size + age + exposure + i(FED)| Date,
data = subset(df, as.Date(Date) <= as.Date('2020-01-01') ),
panel.id = c('IDRSSD','Date'))
reg2 <-feols(dwborrow_bin ~ size + age + exposure + ca + aq + i(FED)| Date,
data = subset(df, as.Date(Date) <= as.Date('2020-01-01') ),
panel.id = c('IDRSSD','Date'))
# 1 SD change in size during covid led to 6% increase in borrowing prob, 1 SD change in size pre-covid led to a 1% increase in borrowing prob.
reg1 <-feols(dwborrow_bin ~ size + age + exposure + ca + aq + i(FED)| Date,
data = subset(df, as.Date(Date) >= as.Date('2020-01-01') & as.Date(Date) <= as.Date('2020-12-01') ),
panel.id = c('IDRSSD','Date'))
etable(reg1,reg2)
# 1 SD change in size during covid led to 6% increase in borrowing prob, 1 SD change in size pre-covid led to a 1% increase in borrowing prob.
reg1 <-feols(dwborrow_bin ~ size + age + exposure + ca + aq + i(FED)| Date + IDRSSD,
data = subset(df, as.Date(Date) >= as.Date('2020-01-01') & as.Date(Date) <= as.Date('2020-12-01') ),
panel.id = c('IDRSSD','Date'))
etable(reg1,reg2)
# 1 SD change in size during covid led to 6% increase in borrowing prob, 1 SD change in size pre-covid led to a 1% increase in borrowing prob.
post <-feols(dwborrow_bin ~ size + age + exposure + ca + aq + i(FED)| Date,
data = subset(df, as.Date(Date) >= as.Date('2020-01-01') & as.Date(Date) <= as.Date('2020-12-01') ),
panel.id = c('IDRSSD','Date'))
pre <-feols(dwborrow_bin ~ size + age + exposure + ca + aq + i(FED)| Date,
data = subset(df, as.Date(Date) <= as.Date('2020-01-01') ),
panel.id = c('IDRSSD','Date'))
etable(post,pre)
rm(reg1,reg2)
# Capital ratios - Duchin Sosyura (2014) ----
df$t1riskrat <- df$RCON7206
df$totriskrat <- df$RCON7205
df$eqcaprat <- df$RCONG105/df$RCON2170
df$t1riskrat
descr(df$t1riskrat)
library('DescTools')
library('summarytools')
descr(df$t1riskrat)
descr(df$totalriskrat)
descr(df$totriskrat)
descr(df$eqcaprat)
# 1 SD change in size during covid led to 6% increase in borrowing prob, 1 SD change in size pre-covid led to a 1% increase in borrowing prob.
post <-feols(dwborrow_bin ~ size + age + exposure + ca + aq + eqcaprat + i(FED)| Date,
data = subset(df, as.Date(Date) >= as.Date('2020-01-01') & as.Date(Date) <= as.Date('2020-12-01') ),
panel.id = c('IDRSSD','Date'))
pre <-feols(dwborrow_bin ~ size + age + exposure + ca + aq + eqcaprat + i(FED)| Date,
data = subset(df, as.Date(Date) <= as.Date('2020-01-01') ),
panel.id = c('IDRSSD','Date'))
etable(post,pre)
etable(post,pre, cluster='FED')
df$roe
# 1 SD change in size during covid led to 6% increase in borrowing prob, 1 SD change in size pre-covid led to a 1% increase in borrowing prob.
post <-feols(dwborrow_bin ~ size + age + exposure + ca + aq + roe + i(FED)| Date,
data = subset(df, as.Date(Date) >= as.Date('2020-01-01') & as.Date(Date) <= as.Date('2020-12-01') ),
panel.id = c('IDRSSD','Date'))
pre <-feols(dwborrow_bin ~ size + age + exposure + ca + aq + roe + i(FED)| Date,
data = subset(df, as.Date(Date) <= as.Date('2020-01-01') ),
panel.id = c('IDRSSD','Date'))
etable(post,pre, cluster='FED')
rm(plot1, pre, post)
rm(cov, agg)
list <- list.files(path="D:/Research/DW lending empirical/Data/SOD/", pattern=".csv")
sod <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[1]),show_col_types = FALSE))
for (i in 2:length(list)) {
sodn <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[i]),show_col_types = FALSE))
sod <- smartbind(sod,sodn)
}
base <- left_join(aggregate(DEPSUMBR ~ STALPBR + YEAR + RSSDHCR, sod, FUN = sum),
aggregate(DEPSUMBR ~ YEAR + RSSDHCR, sod, FUN = sum), by=c('RSSDHCR', 'YEAR'))
base$dep_share <- base$DEPSUMBR.x/base$DEPSUMBR.y
base <- subset(base, base$RSSDHCR >0)[,c('STALPBR','YEAR','RSSDHCR','dep_share')]
base <- spread(base, STALPBR, dep_share)
base <- left_join(base,sod[,c('RSSDHCR','CERT','YEAR')],by=c('RSSDHCR','YEAR'))
base <- base[!duplicated(base[c("RSSDHCR","YEAR")]),]
data.frame(base,rep(c('03-31','06-30','09-30','12-31')))
base <- smartbind(base,base); base <- smartbind(base,base)
base <- pdata.frame(base,index = c('RSSDHCR','YEAR'))
q <- c("/03/31","/06/30","/09/30","/12/31")
base <- data.frame(base, rep(q,nrow(base)/4))
base$Date <- as.Date(paste0(base$YEAR,base$rep.q..nrow.base..4.))
base <- pdata.frame(data.frame(base),index = c('RSSDHCR','Date'))
base <- base[ , -which(names(base) %in% c("rep.q..nrow.base..4."))]
for (i in 3:ncol(base)-1){
base[,i] <- lead(base[,i],2)
}
base$Date <- as.Date(base$Date)
base$RSSDHCR <- as.numeric(as.character(base$RSSDHCR))
sci <- data.frame(read_delim("D:/Research/DW lending empirical/Data/SOD/CI/coincident-revised.csv",show_col_types = FALSE))
sci$time <- as.Date(timeLastDayInQuarter(as.Date(sci$Date,'%m/%d/%Y')))
sci <- sci[seq(1, nrow(sci), 3), ][2:ncol(sci)]
sci
names(sci)
View(sci)
list <- names(sci)
lag(sci,1)
lag(pdata.frame(sci, 'time'),1)
diff(sci)
diff(sci$AL)
length(diff(sci$AL))
c(diff(sci$AL),NA)
i = 1
c(diff(sci[,i]),NA)
for (i in 1:ncol(sci)-1) {
sci[,i] <- c(diff(sci[,i]),NA)
}
sci[,i]
ncol(sci)-1
for (i in 1:ncol(sci)-1) {
sci[,i] <- c(diff(sci[,i]),NA)
}
i = 1
for (i in 1:ncol(sci)-1) {
sci[,i] <- c(diff(sci[,i]),NA)
}
i = 1
c(diff(sci[,i]),NA)
for (i in 1:(ncol(sci)-1)) {
sci[,i] <- c(diff(sci[,i]),NA)
}
join <- data.frame(base[,c(1:2,62:63)],
mapply("*", base[intersect(names(base), names(sci))],
sci[intersect(names(base), names(sci))]))
join <- data.frame(join[,1:4], exposure = rowSums(join[5:ncol(join)], na.rm = TRUE))
join <- join[!is.na(join$RSSDHCR),]
rm(sod, sodn, sci, base)
write.csv(join,"D:\\Research\\DW lending empirical\\Data\\sod_merged.csv")
# For Q4 2009
list <- list.files(path="D:/Research/DW lending empirical/Data/SOD/", pattern=".csv")
sod <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[1]),show_col_types = FALSE))
for (i in 2:length(list)) {
sodn <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[i]),show_col_types = FALSE))
sod <- smartbind(sod,sodn)
}
base <- left_join(aggregate(DEPSUMBR ~ STALPBR + YEAR + RSSDHCR, sod, FUN = sum),
aggregate(DEPSUMBR ~ YEAR + RSSDHCR, sod, FUN = sum), by=c('RSSDHCR', 'YEAR'))
base$dep_share <- base$DEPSUMBR.x/base$DEPSUMBR.y
base <- subset(base, base$RSSDHCR >0)[,c('STALPBR','YEAR','RSSDHCR','dep_share')]
base <- spread(base, STALPBR, dep_share)
base <- left_join(base,sod[,c('RSSDHCR','CERT','YEAR')],by=c('RSSDHCR','YEAR'))
base <- base[!duplicated(base[c("RSSDHCR","YEAR")]),]
data.frame(base,rep(c('03-31','06-30','09-30','12-31')))
base <- smartbind(base,base); base <- smartbind(base,base)
base <- pdata.frame(base,index = c('RSSDHCR','YEAR'))
q <- c("/03/31","/06/30","/09/30","/12/31")
base <- data.frame(base, rep(q,nrow(base)/4))
base$Date <- as.Date(paste0(base$YEAR,base$rep.q..nrow.base..4.))
base <- pdata.frame(data.frame(base),index = c('RSSDHCR','Date'))
base <- base[ , -which(names(base) %in% c("rep.q..nrow.base..4."))]
for (i in 3:ncol(base)-1){
base[,i] <- lead(base[,i],2)
}
base$Date <- as.Date(base$Date)
base$RSSDHCR <- as.numeric(as.character(base$RSSDHCR))
sci <- data.frame(read_delim("D:/Research/DW lending empirical/Data/SOD/CI/coincident-revised.csv",show_col_types = FALSE))
sci$time <- as.Date(timeLastDayInQuarter(as.Date(sci$Date,'%m/%d/%Y')))
sci <- sci[seq(1, nrow(sci), 3), ][2:ncol(sci)]
list <- names(sci)
for (i in 1:(ncol(sci)-1)) {
sci[,i] <- c(diff(sci[,i]),NA)
}
basebase
# For Q4 2009
list <- list.files(path="D:/Research/DW lending empirical/Data/SOD/", pattern=".csv")
sod <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[1]),show_col_types = FALSE))
for (i in 2:length(list)) {
sodn <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[i]),show_col_types = FALSE))
sod <- smartbind(sod,sodn)
}
base <- left_join(aggregate(DEPSUMBR ~ STALPBR + YEAR + RSSDHCR, sod, FUN = sum),
aggregate(DEPSUMBR ~ YEAR + RSSDHCR, sod, FUN = sum), by=c('RSSDHCR', 'YEAR'))
library(tidyverse)
library(mlr3verse)
library(plm)
library(readxl)
library(dplyr)
library('DataCombine')
library('stargazer')
library('simpleboot')
library('Rpdb')
library('data.table')
library(ggplot2)
library(gtools)
library(lubridate)
library("R.utils")
list <- list.files(path="D:/Research/DW lending empirical/Data/SOD/", pattern=".csv")
sod <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[1]),show_col_types = FALSE))
for (i in 2:length(list)) {
sodn <- data.frame(read_delim(paste0("D:/Research/DW lending empirical/Data/SOD/",list[i]),show_col_types = FALSE))
sod <- smartbind(sod,sodn)
}
base <- left_join(aggregate(DEPSUMBR ~ STALPBR + YEAR + RSSDHCR, sod, FUN = sum),
aggregate(DEPSUMBR ~ YEAR + RSSDHCR, sod, FUN = sum), by=c('RSSDHCR', 'YEAR'))
base$dep_share <- base$DEPSUMBR.x/base$DEPSUMBR.y
base <- subset(base, base$RSSDHCR >0)[,c('STALPBR','YEAR','RSSDHCR','dep_share')]
base <- spread(base, STALPBR, dep_share)
base <- left_join(base,sod[,c('RSSDHCR','CERT','YEAR')],by=c('RSSDHCR','YEAR'))
base <- base[!duplicated(base[c("RSSDHCR","YEAR")]),]
data.frame(base,rep(c('03-31','06-30','09-30','12-31')))
base <- smartbind(base,base); base <- smartbind(base,base)
base <- pdata.frame(base,index = c('RSSDHCR','YEAR'))
q <- c("/03/31","/06/30","/09/30","/12/31")
base <- data.frame(base, rep(q,nrow(base)/4))
base$Date <- as.Date(paste0(base$YEAR,base$rep.q..nrow.base..4.))
base <- pdata.frame(data.frame(base),index = c('RSSDHCR','Date'))
base <- base[ , -which(names(base) %in% c("rep.q..nrow.base..4."))]
for (i in 3:ncol(base)-1){
base[,i] <- lead(base[,i],2)
}
base$Date <- as.Date(base$Date)
base$RSSDHCR <- as.numeric(as.character(base$RSSDHCR))
sci <- data.frame(read_delim("D:/Research/DW lending empirical/Data/SOD/CI/coincident-revised.csv",show_col_types = FALSE))
sci$time <- as.Date(timeLastDayInQuarter(as.Date(sci$Date,'%m/%d/%Y')))
sci <- sci[seq(1, nrow(sci), 3), ][2:ncol(sci)]
list <- names(sci)
for (i in 1:(ncol(sci)-1)) {
sci[,i] <- c(diff(sci[,i]),NA)
}
join <- data.frame(base[,c(1:2,62:63)],
mapply("*", base[intersect(names(base), names(sci))],
sci[intersect(names(base), names(sci))]))
join <- data.frame(join[,1:4], exposure = rowSums(join[5:ncol(join)], na.rm = TRUE))
join <- join[!is.na(join$RSSDHCR),]
base
base <- left_join(aggregate(DEPSUMBR ~ STALPBR + YEAR + RSSDHCR, sod, FUN = sum),
aggregate(DEPSUMBR ~ YEAR + RSSDHCR, sod, FUN = sum), by=c('RSSDHCR', 'YEAR'))
base$dep_share <- base$DEPSUMBR.x/base$DEPSUMBR.y
base <- subset(base, base$RSSDHCR >0)[,c('STALPBR','YEAR','RSSDHCR','dep_share')]
base <- spread(base, STALPBR, dep_share)
base
base <- left_join(base,sod[,c('RSSDHCR','CERT','YEAR')],by=c('RSSDHCR','YEAR'))
base <- base[!duplicated(base[c("RSSDHCR","YEAR")]),]
data.frame(base,rep(c('03-31','06-30','09-30','12-31')))
base <- base[!duplicated(base[c("RSSDHCR","YEAR")]),]
base <- smartbind(base,base); base <- smartbind(base,base)
base <- pdata.frame(base,index = c('RSSDHCR','YEAR'))
q <- c("/03/31","/06/30","/09/30","/12/31")
base <- data.frame(base, rep(q,nrow(base)/4))
base$Date <- as.Date(paste0(base$YEAR,base$rep.q..nrow.base..4.))
base <- pdata.frame(data.frame(base),index = c('RSSDHCR','Date'))
base <- base[ , -which(names(base) %in% c("rep.q..nrow.base..4."))]
for (i in 3:ncol(base)-1){
base[,i] <- lead(base[,i],2)
}
View(base)
base <- left_join(aggregate(DEPSUMBR ~ STALPBR + YEAR + RSSDHCR, sod, FUN = sum),
aggregate(DEPSUMBR ~ YEAR + RSSDHCR, sod, FUN = sum), by=c('RSSDHCR', 'YEAR'))
base$dep_share <- base$DEPSUMBR.x/base$DEPSUMBR.y
base <- subset(base, base$RSSDHCR >0)[,c('STALPBR','YEAR','RSSDHCR','dep_share')]
base <- spread(base, STALPBR, dep_share)
base <- left_join(base,sod[,c('RSSDHCR','CERT','YEAR')],by=c('RSSDHCR','YEAR'))
base <- base[!duplicated(base[c("RSSDHCR","YEAR")]),]
base <- smartbind(base,base); base <- smartbind(base,base)
base <- pdata.frame(base,index = c('RSSDHCR','YEAR'))
q <- c("/03/31","/06/30","/09/30","/12/31")
base <- data.frame(base, rep(q,nrow(base)/4))
base$Date <- as.Date(paste0(base$YEAR,base$rep.q..nrow.base..4.))
base <- pdata.frame(data.frame(base),index = c('RSSDHCR','Date'))
base <- base[ , -which(names(base) %in% c("rep.q..nrow.base..4."))]
base[seq(1, nrow(base), 4), ]
base
for (i in 3:ncol(base)-1){
base[,i] <- lead(base[,i],2)
}
base$Date <- as.Date(base$Date)
base$RSSDHCR <- as.numeric(as.character(base$RSSDHCR))
sci <- data.frame(read_delim("D:/Research/DW lending empirical/Data/SOD/CI/coincident-revised.csv",show_col_types = FALSE))
sci$time <- as.Date(timeLastDayInQuarter(as.Date(sci$Date,'%m/%d/%Y')))
sci
sci[seq(1, nrow(sci), 3), ][2:ncol(sci)]
sci <- sci[seq(1, nrow(sci), 3), ][2:ncol(sci)]
list <- names(sci)
for (i in 1:(ncol(sci)-1)) {
sci[,i] <- c(diff(sci[,i]),NA)
}
sci
join <- data.frame(base[,c(1:2,62:63)],
mapply("*", base[intersect(names(base), names(sci))],
sci[intersect(names(base), names(sci))]))
join
join <- data.frame(join[,1:4], exposure = rowSums(join[5:ncol(join)], na.rm = TRUE))
join <- join[!is.na(join$RSSDHCR),]
join
subset(join, as.Date(Date) == as.Date('2020-06-30'))
subset(join, as.Date(Date) == as.Date('2020-03-31'))
sci
View(sci)
sci
data.frame(base[,c(1:2,62:63)],
mapply("*", base[intersect(names(base), names(sci))],
sci[intersect(names(base), names(sci))]))
view(data.frame(base[,c(1:2,62:63)],
mapply("*", base[intersect(names(base), names(sci))],
sci[intersect(names(base), names(sci))])))
j1 <- data.frame(base[,c(1:2,62:63)],
mapply("*", base[intersect(names(base), names(sci))],
sci[intersect(names(base), names(sci))]))
View(j1)
base
View(base)
rowSums(base)
rowSums(base[,3:62])
rowSums(base[,3:61])
as.numeric(base[,3:61])
