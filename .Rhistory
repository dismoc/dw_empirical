sf2$r_delt <- -sf2$PPPLF + sf2$PPP
sf2 <- sf2[order(sf2$RSSD,sf2$Date),]
sf2 <- sf2 %>% group_by(RSSD) %>% mutate(cs_ppp = cumsum(PPP), cs_delt = cumsum(r_delt))
sf2$month <- month(sf2$Date)
sf2$demand_so_reserves <- sf2$r_delt/(sf2$RCON0010*1000)
sf2 <- sf2 %>% mutate(rd_quint = ntile(r_delt, 5))
sf2 <- sf2 %>% mutate(ds_quint = ntile(demand_so_reserves, 5))
sf2$delt_so_reserves <- sf2$cs_delt/(sf2$RCON0010*1000)
r1 <- feols(dw_bin ~ ppp_so_reserves*PPPLF_ind |State + month, subset(sf2, ds_quint>=0))
r2 <- update(r1, .~.+reserve_asset_ratio)
r3 <- update(r2, .~.+size)
r4 <- update(r3, .~. + log(PPPLF+1))
r5 <- update(r4, .~.  +eqcaprat)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
#Robustness
r6 <- feglm(dw_bin ~ demand_so_reserves*PPPLF_ind + reserve_asset_ratio + size + log(PPPLF+1) + eqcaprat| State + month, sf2, se = 'white', family = binomial(link = "logit"))
r7 <- update(r6, family = binomial(link = "probit"))
etable(r5,r6,r7, dict=dict1,
se='cluster',
tex=F)
sf2$ppp_so_reserves <- sf2$cs_ppp/(sf2$RCON0010*1000)
r1 <- feols(dw_bin ~ ppp_so_reserves*PPPLF_ind |State + month, subset(sf2, ds_quint>=0))
r2 <- update(r1, .~.+reserve_asset_ratio)
r3 <- update(r2, .~.+size)
r4 <- update(r3, .~. + log(PPPLF+1))
r5 <- update(r4, .~.  +eqcaprat)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
#Table 1: Binary regression: 1) baseline 2-5) progressively more controls
r1 <- feols(dw_bin ~ delt_so_reserves*PPPLF_ind |State + month, subset(sf2, ds_quint>=0))
r2 <- update(r1, .~.+reserve_asset_ratio)
r3 <- update(r2, .~.+size)
r4 <- update(r3, .~. + log(PPPLF+1))
r5 <- update(r4, .~.  +eqcaprat)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
r1 <- feols(dw_bin ~ delt_so_reserves |State + month, subset(sf2, ds_quint>=0))
r2 <- update(r1, .~.+reserve_asset_ratio)
r3 <- update(r2, .~.+size)
r4 <- update(r3, .~. + log(PPPLF+1))
r5 <- update(r4, .~.  +eqcaprat)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
r1 <- feols(dw_bin ~ ppp_so_reserves |State + month, subset(sf2, ds_quint>=0))
r2 <- update(r1, .~.+reserve_asset_ratio)
r3 <- update(r2, .~.+size)
r4 <- update(r3, .~. + log(PPPLF+1))
r5 <- update(r4, .~.  +eqcaprat)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
r4 <- update(r3, .~. + log(PPPLF))
r5 <- update(r4, .~.  +eqcaprat)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
r1 <- feols(dw_bin ~ PPP |State + month, subset(sf2, ds_quint>=0))
r2 <- update(r1, .~.+reserve_asset_ratio)
r3 <- update(r2, .~.+size)
r4 <- update(r3, .~. + log(PPPLF+1))
r5 <- update(r4, .~.  +eqcaprat)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
sf2
sf2[is.na(sf2$reserve_asset_ratio) == FALSE,]
sf2$ppp_so_reserves <- sf2$PPP/(sf2$RCON0010*1000)
sf2$delt_so_reserves <- sf2$r_delt/(sf2$RCON0010*1000)
r1 <- feols(dw_bin ~ PPP |State + month, subset(sf2, ds_quint>=0))
r2 <- update(r1, .~.+reserve_asset_ratio)
r3 <- update(r2, .~.+size)
r4 <- update(r3, .~. + log(PPPLF+1))
r5 <- update(r4, .~.  +eqcaprat)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
r1 <- feols(dw_bin ~ ppp_so_reserves |State + month, subset(sf2, ds_quint>=0))
r2 <- update(r1, .~.+reserve_asset_ratio)
r3 <- update(r2, .~.+size)
r4 <- update(r3, .~. + log(PPPLF+1))
r5 <- update(r4, .~.  +eqcaprat)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
#Table 1: Binary regression: 1) baseline 2-5) progressively more controls
r1 <- feols(dw_bin ~ delt_so_reserves |State + month, subset(sf2, ds_quint>=0))
r2 <- update(r1, .~.+reserve_asset_ratio)
r3 <- update(r2, .~.+size)
r4 <- update(r3, .~. + log(PPPLF+1))
r5 <- update(r4, .~.  +eqcaprat)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
#Robustness
r6 <- feglm(dw_bin ~ demand_so_reserves*PPPLF_ind + reserve_asset_ratio + size + log(PPPLF+1) + eqcaprat| State + month, sf2, se = 'white', family = binomial(link = "logit"))
r7 <- update(r6, family = binomial(link = "probit"))
etable(r5,r6,r7, dict=dict1,
se='cluster',
tex=F)
#Robustness
r6 <- feglm(dw_bin ~ delt_so_reserves*PPPLF_ind + reserve_asset_ratio + size + log(PPPLF+1) + eqcaprat| State + month, sf2, se = 'white', family = binomial(link = "logit"))
r7 <- update(r6, family = binomial(link = "probit"))
etable(r5,r6,r7, dict=dict1,
se='cluster',
tex=F)
r1 <- feols(dw_bin ~ ppp_so_reserves |State + month, subset(sf2, ds_quint>=0))
r2 <- update(r1, .~.+reserve_asset_ratio)
r3 <- update(r2, .~.+size)
r4 <- update(r3, .~. + log(PPPLF+1))
r5 <- update(r4, .~.  +eqcaprat)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
#Robustness
r6 <- feglm(dw_bin ~ ppp_so_reserves*PPPLF_ind + reserve_asset_ratio + size + log(PPPLF+1) + eqcaprat| State + month, sf2, se = 'white', family = binomial(link = "logit"))
r7 <- update(r6, family = binomial(link = "probit"))
etable(r5,r6,r7, dict=dict1,
se='cluster',
tex=F)
progressively more controls
r1 <- feols(dw_bin ~ ppp_so_reserves*PPPLF_ind |State + month, subset(sf2, ds_quint>=0))
r2 <- update(r1, .~.+reserve_asset_ratio)
r3 <- update(r2, .~.+size)
r4 <- update(r3, .~. + log(PPPLF+1))
r5 <- update(r4, .~.  +eqcaprat)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
#Table 1: Binary regression: 1) baseline 2-5) progressively more controls
r1 <- feols(dw_bin ~ ppp_so_reserves*PPPLF_ind |RSSD + month, subset(sf2, ds_quint>=0))
r2 <- update(r1, .~.+reserve_asset_ratio)
r3 <- update(r2, .~.+size)
r4 <- update(r3, .~. + log(PPPLF+1))
r5 <- update(r4, .~.  +eqcaprat)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
r6 <- feglm(dw_bin ~ ppp_so_reserves*PPPLF_ind + reserve_asset_ratio + size + log(PPPLF+1) + eqcaprat| RSSD + month, sf2, se = 'white', family = binomial(link = "logit"))
r7 <- update(r6, family = binomial(link = "probit"))
etable(r5,r6,r7, dict=dict1,
se='cluster',
tex=F)
etable(r5,r6,r7, dict=dict1,
se='white',
tex=F)
r6 <- feglm(dw_bin ~ ppp_so_reserves + reserve_asset_ratio + size + log(PPPLF+1) + eqcaprat| RSSD + month, sf2, se = 'white', family = binomial(link = "logit"))
r7 <- update(r6, family = binomial(link = "probit"))
etable(r5,r6,r7, dict=dict1,
se='white',
tex=F)
# Regression on demand share of reserves using reserve data from Q1 2020
dict1 <- c('dw_bin' = 'DW Prob', 'demand_so_reserves' = 'Demand Shock', 'reserve_asset_ratio' = 'RA Ratio',
'size' = 'Log(Asset)', 'log(PPPLF+1)' = 'Log(PPPLF)', 'log(RCON0010)' = 'Log(Reserves)',
'eqcaprat' = 'Equity Cap Ratio', 'ppp_so_reserves' = 'Demand Shock',
'ppp_so_reserves x PPPLF_ind' = 'DS*PPPLF_ind')
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
r1 <- feols(dw_bin ~ ppp_so_reserves*PPPLF_ind |State + month, subset(sf2, ds_quint>=0))
r2 <- update(r1, .~.+reserve_asset_ratio)
r3 <- update(r2, .~.+size)
r4 <- update(r3, .~. + log(PPPLF+1))
r5 <- update(r4, .~.  +eqcaprat)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
r1 <- feols(dw_bin ~ ppp_so_reserves*PPPLF_ind |State + month, subset(sf2, ds_quint>=0))
r2 <- update(r1, .~.+reserve_asset_ratio)
r3 <- update(r2, .~.+size)
r4 <- update(r3, .~.  +eqcaprat)
#Main
etable(r1,r2,r3,r4, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
#Robustness
df$borr_total
sf2 <- data.frame(RSSD = sf2$rssd, Date = sf2$DateApproved, ABA = sf2$ABA, State = sf2$STATE_ABBR_NM, PPP = sf2$InitialApprovalAmount)
sf2 <- full_join(sf2, data.frame(aggregate(Original.Outstanding.Advance.Amount ~ Institution.RSSD + Date.Of.Advance, pplf, sum)),
by=c('RSSD' = 'Institution.RSSD', 'Date' = 'Date.Of.Advance')) %>% select(-contains("..."))
dwborrow$Borrower.ABA.number <- as.numeric(dwborrow$Borrower.ABA.number)
dwborrow <- subset(dwborrow,Loan.date >= as.Date('2020-04-03') & Loan.date <= as.Date('2020-08-08'))
sf2 <- left_join(sf2,dwborrow[,c('Loan.date','Borrower.ABA.number','Loan.amount')], by=c('ABA' = 'Borrower.ABA.number', 'Date' = 'Loan.date'))
temp <- subset(df, as.Date(Date) == as.Date('2020-03-31'))[,c('size','IDRSSD','reserve_asset_ratio','reserve_loan_ratio','RCON0010','eqcaprat','age','borr_total')]
temp$IDRSSD <- as.numeric(as.character(temp$IDRSSD))
sf2 <- left_join(sf2, temp, by=c('RSSD' = 'IDRSSD'))
sf2[is.na(sf2$Original.Outstanding.Advance.Amount),c('Original.Outstanding.Advance.Amount')] <- 0
sf2[is.na(sf2$Loan.amount),c('Loan.amount')] <- 0
sf2[is.na(sf2$borr_total) == TRUE, 'borr_total'] <- 0
setnames(sf2, old=c('Original.Outstanding.Advance.Amount', 'Loan.amount'),
new = c('PPPLF','DW'))
sf2$dw_bin <- ifelse(sf2$DW > 0, 1, 0)
sf2$PPPLF_ind <- ifelse(sf2$PPPLF > 0, 1, 0)
sf2$r_delt <- -sf2$PPPLF + sf2$PPP
sf2 <- sf2[order(sf2$RSSD,sf2$Date),]
sf2 <- sf2 %>% group_by(RSSD) %>% mutate(cs_ppp = cumsum(PPP), cs_delt = cumsum(r_delt))
sf2$month <- month(sf2$Date)
sf2$ppp_so_reserves <- sf2$PPP/(sf2$RCON0010*1000)
sf2$delt_so_reserves <- sf2$r_delt/(sf2$RCON0010*1000)
sf2 <- sf2 %>% mutate(rd_quint = ntile(r_delt, 5))
sf2 <- sf2 %>% mutate(ds_quint = ntile(demand_so_reserves, 5))
temp <- subset(df, as.Date(Date) == as.Date('2020-03-31'))
sf2 <- aggregate(InitialApprovalAmount ~ rssd + DateApproved, pppm, sum)
sf2 <- full_join(sf2, unique(df[,c('IDRSSD','Primary.ABA.Routing.Number')]), by=c('rssd' = 'IDRSSD'))
sf2 <- left_join(sf2, att, by=c('rssd' = '#ID_RSSD'))
sf2$ABA <- coalesce(sf2$Primary.ABA.Routing.Number, sf2$ID_ABA_PRIM)
#sf2 <- full_join(pppm,unique(pplf[,c('Institution.RSSD','Institution.ABA')]),by=c('rssd' = 'Institution.RSSD')) %>% select(-contains("..."))
#sf2$ABA <- ifelse(sf2$ID_ABA_PRIM == 0 | is.na(sf2$ID_ABA_PRIM) == TRUE, sf2$Institution.ABA, sf2$ID_ABA_PRIM)
sf2 <- data.frame(RSSD = sf2$rssd, Date = sf2$DateApproved, ABA = sf2$ABA, State = sf2$STATE_ABBR_NM, PPP = sf2$InitialApprovalAmount)
sf2 <- full_join(sf2, data.frame(aggregate(Original.Outstanding.Advance.Amount ~ Institution.RSSD + Date.Of.Advance, pplf, sum)),
by=c('RSSD' = 'Institution.RSSD', 'Date' = 'Date.Of.Advance')) %>% select(-contains("..."))
dwborrow$Borrower.ABA.number <- as.numeric(dwborrow$Borrower.ABA.number)
dwborrow <- subset(dwborrow,Loan.date >= as.Date('2020-04-03') & Loan.date <= as.Date('2020-08-08'))
sf2 <- left_join(sf2,dwborrow[,c('Loan.date','Borrower.ABA.number','Loan.amount')], by=c('ABA' = 'Borrower.ABA.number', 'Date' = 'Loan.date'))
temp <- subset(df, as.Date(Date) == as.Date('2020-03-31'))[,c('size','IDRSSD','reserve_asset_ratio','reserve_loan_ratio','RCON0010','eqcaprat','age','borr_total')]
temp$IDRSSD <- as.numeric(as.character(temp$IDRSSD))
sf2 <- left_join(sf2, temp, by=c('RSSD' = 'IDRSSD'))
sf2[is.na(sf2$Original.Outstanding.Advance.Amount),c('Original.Outstanding.Advance.Amount')] <- 0
sf2[is.na(sf2$Loan.amount),c('Loan.amount')] <- 0
sf2[is.na(sf2$borr_total) == TRUE, 'borr_total'] <- 0
setnames(sf2, old=c('Original.Outstanding.Advance.Amount', 'Loan.amount'),
new = c('PPPLF','DW'))
sf2$dw_bin <- ifelse(sf2$DW > 0, 1, 0)
sf2$PPPLF_ind <- ifelse(sf2$PPPLF > 0, 1, 0)
sf2$r_delt <- -sf2$PPPLF + sf2$PPP
sf2 <- sf2[order(sf2$RSSD,sf2$Date),]
sf2 <- sf2 %>% group_by(RSSD) %>% mutate(cs_ppp = cumsum(PPP), cs_delt = cumsum(r_delt))
sf2$month <- month(sf2$Date)
sf2$ppp_so_reserves <- sf2$PPP/(sf2$RCON0010*1000)
sf2$delt_so_reserves <- sf2$r_delt/(sf2$RCON0010*1000)
sf2 <- sf2 %>% mutate(rd_quint = ntile(r_delt, 5))
sf2 <- sf2 %>% mutate(ds_quint = ntile(demand_so_reserves, 5))
sf2 <- sf2 %>% mutate(ds_quint = ntile(ppp_so_reserves, 5))
# Regression on demand share of reserves using reserve data from Q1 2020
dict1 <- c('dw_bin' = 'DW Prob', 'demand_so_reserves' = 'Demand Shock', 'reserve_asset_ratio' = 'RA Ratio',
'size' = 'Log(Asset)', 'log(PPPLF+1)' = 'Log(PPPLF)', 'log(RCON0010)' = 'Log(Reserves)',
'eqcaprat' = 'Equity Cap Ratio', 'ppp_so_reserves' = 'Demand Shock',
'ppp_so_reserves x PPPLF_ind' = 'DS*PPPLF_ind')
sf2
r1 <- feols(dw_bin ~ ppp_so_reserves*PPPLF_ind |State + month, subset(sf2, ds_quint>=0))
r2 <- update(r1, .~. +reserve_asset_ratio)
r3 <- update(r2, .~. +size)
r4 <- update(r3, .~. +eqcaprat)
r5 <- update(r4, .~. +borr_total)
#Main
etable(r1,r2,r3,r4, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
r5 <- update(r4, .~. +log(borr_total+1))
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
r6 <- feglm(dw_bin ~ ppp_so_reserves + reserve_asset_ratio + size + eqcaprat + log(borr_total+1) | RSSD + month, sf2, se = 'white', family = binomial(link = "logit"))
r7 <- update(r6, family = binomial(link = "probit"))
etable(r5,r6,r7, dict=dict1,
se='',
tex=F)
etable(r5,r6,r7, dict=dict1,
se='white',
tex=F)
#Robustness
r6 <- feglm(dw_bin ~ ppp_so_reserves*PPPLF_ind + reserve_asset_ratio + size + eqcaprat + log(borr_total+1) | RSSD + month, sf2, se = 'white', family = binomial(link = "logit"))
r7 <- update(r6, family = binomial(link = "probit"))
etable(r5,r6,r7, dict=dict1,
se='white',
tex=F)
#Robustness
r6 <- feglm(dw_bin ~ ppp_so_reserves*PPPLF_ind + reserve_asset_ratio + size + eqcaprat + log(borr_total+1) | State + month, sf2, se = 'white', family = binomial(link = "logit"))
r7 <- update(r6, family = binomial(link = "probit"))
etable(r5,r6,r7, dict=dict1,
se='white',
tex=F)
etable(r5,r6,r7, dict=dict1,
se='cluster',
tex=F)
summary(marginaleffects(r5))
temp <- subset(df, as.Date(Date) == as.Date('2020-03-31'))
sf2 <- aggregate(InitialApprovalAmount ~ rssd + DateApproved, pppm, sum)
sf2 <- full_join(sf2, unique(df[,c('IDRSSD','Primary.ABA.Routing.Number')]), by=c('rssd' = 'IDRSSD'))
sf2 <- left_join(sf2, att, by=c('rssd' = '#ID_RSSD'))
sf2$ABA <- coalesce(sf2$Primary.ABA.Routing.Number, sf2$ID_ABA_PRIM)
sf2 <- data.frame(RSSD = sf2$rssd, Date = sf2$DateApproved, ABA = sf2$ABA, State = sf2$STATE_ABBR_NM, PPP = sf2$InitialApprovalAmount)
sf2 <- full_join(sf2, data.frame(aggregate(Original.Outstanding.Advance.Amount ~ Institution.RSSD + Date.Of.Advance, pplf, sum)),
by=c('RSSD' = 'Institution.RSSD', 'Date' = 'Date.Of.Advance')) %>% select(-contains("..."))
dwborrow$Borrower.ABA.number <- as.numeric(dwborrow$Borrower.ABA.number)
dwborrow <- subset(dwborrow,Loan.date >= as.Date('2020-04-03') & Loan.date <= as.Date('2020-08-08'))
sf2 <- full_join(sf2,dwborrow[,c('Loan.date','Borrower.ABA.number','Loan.amount')], by=c('ABA' = 'Borrower.ABA.number', 'Date' = 'Loan.date'))
temp <- subset(df, as.Date(Date) == as.Date('2020-03-31'))[,c('size','IDRSSD','reserve_asset_ratio','reserve_loan_ratio','RCON0010','eqcaprat','age','borr_total')]
temp$IDRSSD <- as.numeric(as.character(temp$IDRSSD))
sf2 <- left_join(sf2, temp, by=c('RSSD' = 'IDRSSD'))
sf2[is.na(sf2$Original.Outstanding.Advance.Amount),c('Original.Outstanding.Advance.Amount')] <- 0
sf2[is.na(sf2$Loan.amount),c('Loan.amount')] <- 0
sf2[is.na(sf2$borr_total) == TRUE, 'borr_total'] <- 0
setnames(sf2, old=c('Original.Outstanding.Advance.Amount', 'Loan.amount'),
new = c('PPPLF','DW'))
sf2$dw_bin <- ifelse(sf2$DW > 0, 1, 0)
sf2$PPPLF_ind <- ifelse(sf2$PPPLF > 0, 1, 0)
sf2$r_delt <- -sf2$PPPLF + sf2$PPP
sf2 <- sf2[order(sf2$RSSD,sf2$Date),]
sf2 <- sf2 %>% group_by(RSSD) %>% mutate(cs_ppp = cumsum(PPP), cs_delt = cumsum(r_delt))
sf2$month <- month(sf2$Date)
sf2$ppp_so_reserves <- sf2$PPP/(sf2$RCON0010*1000)
sf2$delt_so_reserves <- sf2$r_delt/(sf2$RCON0010*1000)
sf2 <- sf2 %>% mutate(rd_quint = ntile(r_delt, 5))
sf2 <- sf2 %>% mutate(ds_quint = ntile(ppp_so_reserves, 5))
# Regression on demand share of reserves using reserve data from Q1 2020
dict1 <- c('dw_bin' = 'DW Prob', 'demand_so_reserves' = 'Demand Shock', 'reserve_asset_ratio' = 'RA Ratio',
'size' = 'Log(Asset)', 'log(PPPLF+1)' = 'Log(PPPLF)', 'log(RCON0010)' = 'Log(Reserves)',
'eqcaprat' = 'Equity Cap Ratio', 'ppp_so_reserves' = 'Demand Shock',
'ppp_so_reserves x PPPLF_ind' = 'DS*PPPLF_ind')
r1 <- feols(dw_bin ~ ppp_so_reserves*PPPLF_ind |State + month, subset(sf2, ds_quint>=0))
r2 <- update(r1, .~. +reserve_asset_ratio)
r3 <- update(r2, .~. +size)
r4 <- update(r3, .~. +eqcaprat)
r5 <- update(r4, .~. +log(borr_total+1))
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
sf2
#Table 1: Binary regression: 1) baseline 2-5) progressively more controls
r1 <- feols(dw_bin ~ ppp_so_reserves*PPPLF_ind |State + month, sf2)
r2 <- update(r1, .~. +reserve_asset_ratio)
r3 <- update(r2, .~. +size)
r4 <- update(r3, .~. +eqcaprat)
r5 <- update(r4, .~. +log(borr_total+1))
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
#Robustness
r6 <- feglm(dw_bin ~ ppp_so_reserves*PPPLF_ind + reserve_asset_ratio + size + eqcaprat + log(borr_total+1) | State + month, sf2, se = 'white', family = binomial(link = "logit"))
sf2
# Regression on demand share of reserves using reserve data from Q1 2020
dict1 <- c('dw_bin' = 'DW Prob', 'demand_so_reserves' = 'Demand Shock', 'reserve_asset_ratio' = 'RA Ratio',
'size' = 'Log(Asset)', 'log(PPPLF+1)' = 'Log(PPPLF)', 'log(RCON0010)' = 'Log(Reserves)',
'eqcaprat' = 'Equity Cap Ratio', 'ppp_so_reserves' = 'Demand Shock',
'ppp_so_reserves x PPPLF_ind' = 'DS*PPPLF_ind', 'log(borr_total+1)' = 'Log(FF Borrowing)')
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
r5 <- update(r4, .~. +Age)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
r5 <- update(r4, .~. +age)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
r6 <- feglm(dw_bin ~ ppp_so_reserves*PPPLF_ind + reserve_asset_ratio + size + eqcaprat + age | State + month, sf2, se = 'white', family = binomial(link = "logit"))
r7 <- update(r6, family = binomial(link = "probit"))
etable(r5,r6,r7, dict=dict1,
se='cluster',
tex=F)
summary(marginaleffects(r5))
etable(r5,r6,r7, dict=dict1,
se='white',
tex=F)
sf2
plot1 <- aggregate(cbind(PPPLF_ind, DW, PPP) ~ RSSD, sf2)
plot1 <- aggregate(cbind(PPPLF_ind, DW, PPP) ~ RSSD, sf2, sum)
plot1
length(plot1$RSSD)
length(subset(plot1, PPP > 0)$RSSD)
length(subset(plot1, DW > 0)$RSSD)
plot1 <- aggregate(cbind(PPPLF, DW, PPP) ~ RSSD, sf2, sum)
length(subset(plot1, DW > 0 & PPPLF == 0)$RSSD)
length(subset(plot1, DW == 0 & PPPLF > 0)$RSSD)
length(subset(plot1, DW == > & PPPLF > 0)$RSSD)
length(subset(plot1, DW > 0 & PPPLF > 0)$RSSD)
descr(sf2$Date)
unique(sf2$Date)
pppm
dwborrow
temp <- subset(df, as.Date(Date) == as.Date('2020-03-31'))
sf2 <- aggregate(InitialApprovalAmount ~ rssd + DateApproved, pppm, sum)
sf2 <- full_join(sf2, unique(df[,c('IDRSSD','Primary.ABA.Routing.Number')]), by=c('rssd' = 'IDRSSD'))
sf2
sf2 <- subset(sf2, DateApproved >= as.Date('2020-04-03') & DateApproved <= as.Date('2020-08-08'))
sf2 <- left_join(sf2, att, by=c('rssd' = '#ID_RSSD'))
sf2$ABA <- coalesce(sf2$Primary.ABA.Routing.Number, sf2$ID_ABA_PRIM)
sf2 <- data.frame(RSSD = sf2$rssd, Date = sf2$DateApproved, ABA = sf2$ABA, State = sf2$STATE_ABBR_NM, PPP = sf2$InitialApprovalAmount)
sf2 <- full_join(sf2, data.frame(aggregate(Original.Outstanding.Advance.Amount ~ Institution.RSSD + Date.Of.Advance, pplf, sum)),
by=c('RSSD' = 'Institution.RSSD', 'Date' = 'Date.Of.Advance')) %>% select(-contains("..."))
dwborrow$Borrower.ABA.number <- as.numeric(dwborrow$Borrower.ABA.number)
dwborrow <- subset(dwborrow,Loan.date >= as.Date('2020-04-03') & Loan.date <= as.Date('2020-08-08'))
sf2 <- full_join(sf2,dwborrow[,c('Loan.date','Borrower.ABA.number','Loan.amount')], by=c('ABA' = 'Borrower.ABA.number', 'Date' = 'Loan.date'))
temp <- subset(df, as.Date(Date) == as.Date('2020-03-31'))[,c('size','IDRSSD','reserve_asset_ratio','reserve_loan_ratio','RCON0010','eqcaprat','age','borr_total')]
temp$IDRSSD <- as.numeric(as.character(temp$IDRSSD))
sf2 <- left_join(sf2, temp, by=c('RSSD' = 'IDRSSD'))
sf2[is.na(sf2$Original.Outstanding.Advance.Amount),c('Original.Outstanding.Advance.Amount')] <- 0
sf2[is.na(sf2$Loan.amount),c('Loan.amount')] <- 0
sf2[is.na(sf2$borr_total) == TRUE, 'borr_total'] <- 0
setnames(sf2, old=c('Original.Outstanding.Advance.Amount', 'Loan.amount'),
new = c('PPPLF','DW'))
sf2$dw_bin <- ifelse(sf2$DW > 0, 1, 0)
sf2$PPPLF_ind <- ifelse(sf2$PPPLF > 0, 1, 0)
sf2$r_delt <- -sf2$PPPLF + sf2$PPP
sf2 <- sf2[order(sf2$RSSD,sf2$Date),]
sf2 <- sf2 %>% group_by(RSSD) %>% mutate(cs_ppp = cumsum(PPP), cs_delt = cumsum(r_delt))
sf2$month <- month(sf2$Date)
sf2$ppp_so_reserves <- sf2$PPP/(sf2$RCON0010*1000)
sf2$delt_so_reserves <- sf2$r_delt/(sf2$RCON0010*1000)
sf2 <- sf2 %>% mutate(dsr_quint = ntile(delt_so_reserves, 5), psr_quint = ntile(ppp_so_reserves, 5))
sf2
unique(sf2$Date)
subset(sf2,Date >= '2020-08-08')
subset(sf2,Date > '2020-08-08')
sf2 <- subset(sf2, DateApproved >= as.Date('2020-04-03') & DateApproved <= as.Date('2020-08-30'))
sf2 <- subset(sf2, Date >= as.Date('2020-04-03') & Date <= as.Date('2020-08-30'))
r1 <- feols(dw_bin ~ ppp_so_reserves*PPPLF_ind |State + month, sf2)
r2 <- update(r1, .~. +reserve_asset_ratio)
r3 <- update(r2, .~. +size)
r4 <- update(r3, .~. +eqcaprat)
r5 <- update(r4, .~. +age)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
#Robustness
r6 <- feglm(dw_bin ~ ppp_so_reserves*PPPLF_ind + reserve_asset_ratio + size + eqcaprat + age | State + month, sf2, se = 'white', family = binomial(link = "logit"))
r7 <- update(r6, family = binomial(link = "probit"))
etable(r5,r6,r7, dict=dict1,
se='white',
tex=F)
summary(marginaleffects(r6))
temp <- subset(df, as.Date(Date) == as.Date('2020-03-31'))
sf2 <- aggregate(InitialApprovalAmount ~ rssd + DateApproved, pppm, sum)
sf2 <- full_join(sf2, unique(df[,c('IDRSSD','Primary.ABA.Routing.Number')]), by=c('rssd' = 'IDRSSD'))
sf2 <- left_join(sf2, att, by=c('rssd' = '#ID_RSSD'))
sf2$ABA <- coalesce(sf2$Primary.ABA.Routing.Number, sf2$ID_ABA_PRIM)
sf2 <- data.frame(RSSD = sf2$rssd, Date = sf2$DateApproved, ABA = sf2$ABA, State = sf2$STATE_ABBR_NM, PPP = sf2$InitialApprovalAmount)
sf2 <- full_join(sf2, data.frame(aggregate(Original.Outstanding.Advance.Amount ~ Institution.RSSD + Date.Of.Advance, pplf, sum)),
by=c('RSSD' = 'Institution.RSSD', 'Date' = 'Date.Of.Advance')) %>% select(-contains("..."))
dwborrow$Borrower.ABA.number <- as.numeric(dwborrow$Borrower.ABA.number)
dwborrow <- subset(dwborrow,Loan.date >= as.Date('2020-04-03') & Loan.date <= as.Date('2020-08-08'))
sf2 <- full_join(sf2,dwborrow[,c('Loan.date','Borrower.ABA.number','Loan.amount')], by=c('ABA' = 'Borrower.ABA.number', 'Date' = 'Loan.date'))
temp <- subset(df, as.Date(Date) == as.Date('2020-03-31'))[,c('size','IDRSSD','reserve_asset_ratio','reserve_loan_ratio','RCON0010','eqcaprat','age','borr_total')]
temp$IDRSSD <- as.numeric(as.character(temp$IDRSSD))
sf2 <- left_join(sf2, temp, by=c('RSSD' = 'IDRSSD'))
sf2[is.na(sf2$Original.Outstanding.Advance.Amount),c('Original.Outstanding.Advance.Amount')] <- 0
sf2[is.na(sf2$Loan.amount),c('Loan.amount')] <- 0
sf2[is.na(sf2$borr_total) == TRUE, 'borr_total'] <- 0
setnames(sf2, old=c('Original.Outstanding.Advance.Amount', 'Loan.amount'),
new = c('PPPLF','DW'))
sf2$dw_bin <- ifelse(sf2$DW > 0, 1, 0)
sf2$PPPLF_ind <- ifelse(sf2$PPPLF > 0, 1, 0)
sf2$r_delt <- -sf2$PPPLF + sf2$PPP
sf2 <- sf2[order(sf2$RSSD,sf2$Date),]
sf2 <- sf2 %>% group_by(RSSD) %>% mutate(cs_ppp = cumsum(PPP), cs_delt = cumsum(r_delt))
sf2$month <- month(sf2$Date)
sf2$ppp_so_reserves <- sf2$PPP/(sf2$RCON0010*1000)
sf2$delt_so_reserves <- sf2$r_delt/(sf2$RCON0010*1000)
sf2 <- sf2 %>% mutate(dsr_quint = ntile(delt_so_reserves, 5), psr_quint = ntile(ppp_so_reserves, 5))
subset(sf2, Date >= as.Date('2020-04-03') & Date <= as.Date('2020-08-30'))
subset(sf2, Date >= as.Date('2020-04-03') & Date >= as.Date('2020-08-30'))
sf3 <- subset(sf2, Date >= as.Date('2020-04-03') & Date <= as.Date('2020-08-30'))
sf3 <- subset(sf2, Date >= as.Date('2020-04-03') & Date >= as.Date('2020-08-30'))
View(sf3)
table(sf3$Date)
r1 <- feols(dw_bin ~ ppp_so_reserves*PPPLF_ind |State + month, sf3)
r2 <- update(r1, .~. +reserve_asset_ratio)
r3 <- update(r2, .~. +size)
r4 <- update(r3, .~. +eqcaprat)
r5 <- update(r4, .~. +age)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
sf3 <- subset(sf2, Date >= as.Date('2020-04-03') & Date <= as.Date('2020-08-30'))
#Table 1: Binary regression: 1) baseline 2-5) progressively more controls
r1 <- feols(dw_bin ~ ppp_so_reserves*PPPLF_ind |State + month, sf3)
r2 <- update(r1, .~. +reserve_asset_ratio)
r3 <- update(r2, .~. +size)
r4 <- update(r3, .~. +eqcaprat)
r5 <- update(r4, .~. +age)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
#Table 1: Binary regression: 1) baseline 2-5) progressively more controls
r1 <- feols(dw_bin ~ log(ppp_so_reserves)*PPPLF_ind |State + month, sf3)
r2 <- update(r1, .~. +reserve_asset_ratio)
r3 <- update(r2, .~. +size)
r4 <- update(r3, .~. +eqcaprat)
r5 <- update(r4, .~. +age)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
#Robustness
r6 <- feglm(dw_bin ~ log(ppp_so_reserves)*PPPLF_ind + reserve_asset_ratio + size + eqcaprat + age | State + month, sf2, se = 'white', family = binomial(link = "logit"))
r7 <- update(r6, family = binomial(link = "probit"))
etable(r5,r6,r7, dict=dict1,
se='white',
tex=F)
r1 <- feols(dw_bin ~ psr_quint*PPPLF_ind |State + month, sf3)
r2 <- update(r1, .~. +reserve_asset_ratio)
r3 <- update(r2, .~. +size)
r4 <- update(r3, .~. +eqcaprat)
r5 <- update(r4, .~. +age)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
r1 <- feols(dw_bin ~ psr_quint*PPPLF_ind |State + month, sf2)
r2 <- update(r1, .~. +reserve_asset_ratio)
r3 <- update(r2, .~. +size)
r4 <- update(r3, .~. +eqcaprat)
r5 <- update(r4, .~. +age)
#Main
etable(r1,r2,r3,r4,r5, dict=dict1,
se='white', fitstat=~n+r2, tex=F)
#Robustness
